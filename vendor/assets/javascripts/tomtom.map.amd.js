var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("tomtom/lib/json2",function(){}),define("tomtom/Main",["./lib/json2"],function(){window.tomtom||(window.tomtom={}),window.tomtom.dom={},window.tomtom.layers={},window.tomtom.services={},window.tomtom.controls={},typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n)e.call(t,this[n],n,this)}),Array.prototype.some||(Array.prototype.some=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1});var e=Object.prototype.toString,t=Array.toString();Array.isArray=Array.isArray||function(n){return typeof n=="object"&&(e.call(n)=="[object Array]"||"constructor"in n&&String(n.constructor)==t)},window.tomtom.setImagePath=function(e){e.lastIndexOf("/")!=e.length-1&&(e+="/"),tomtom.baseImagePath=e},tomtom.setImagePath("./images/"),window.tomtom.API_BASE_URL="https://api.tomtom.com/",window.tomtom.releaseInfo={version:"2.0.0-RELEASE",build:"84"},window.tomtom.isDebugMode=!1,window.tomtom.languages={en_US:{units:{distance:{meter:"m;; m",km:"km;; km",yard:"yd;; yds",mile:"mi;; mi"},time:{day:"day;; days",hour:"hour;; hours",minute:"min;; mins",type:"12"}},errors:{Unknown:"Sorry, an error occurred. Please try again or come back later"},IncidentItem:{from:"From",to:"To",delay:"Delay",length:"Length"},IncidentBalloon:{Cluster:{title:"Incidents in this area: ",listHeader:"{count} most severe incidents",orderedByLength:"(Ordered by length)",orderedByDelay:"(Ordered by delay)"},zoomIn:"Click to zoom in"}}}}),define("tomtom/Utils",["./Main"],function(){tomtom.Utils={hostIndex:0,hosts:[],getServiceUrl:function(e,t,n,r){var i=tomtom.API_BASE_URL;if(t){paramCount=0,e.indexOf("?")==-1&&(e+="?");for(var s in t)paramCount>0&&(e+="&"),e+=s+"="+t[s],paramCount++}return tomtom.proxyUrl&&(i=tomtom.proxyUrl),typeof r!="undefined"&&(r?i=i.replace(/https?:\/\//g,"https://"):i=i.replace(/https?:\/\//g,"http://")),n&&(i="http://"+this.getRandomHost(i)),e.indexOf("https://")==0||e.indexOf("http://")==0?e:i+e},getRandomHost:function(e){e=e.replace(/https?:\/\//g,"");if(typeof tomtom.enableHostCycling=="undefined"||tomtom.enableHostCycling)this.hosts.length==0&&this.initHosts(),e=this.hosts[this.hostIndex],this.hostIndex++,this.hostIndex>3&&(this.hostIndex=0);return e},isArray:function(e){return Array.isArray(e)},zeroPad:function(e,t){e=String(e);var n=[];for(var r=0;r<t;++r)n.push("0");return n.join("").substring(0,t-e.length)+e},setCookie:function(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString()}else var i="";document.cookie=e+"="+t+i+"; path=/"},getCookie:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null},removeCookie:function(e){this.setCookie(e,"",-1)},formatSeconds:function(e){if(e==0)return{value:0,suffix:"minute"};if(e<=3600)return{value:this.round(e/60,1),suffix:"minute"};if(e>=3600)return{value:this.round(e/3600,1),suffix:"hour"}},metersToMiles:function(t){return t*e/5280},round:function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},getUniqueControlId:function(e){var t=e+"_"+n;return n++,t}};var e=3.28084,t=5280,n=0;return tomtom.Utils}),define("tomtom/BaseObject",["./Main","./Utils"],function(e,t){return tomtom.BaseObject=L.Class.extend({initialize:function(){},hitch:function(e){return L.Util.bind(e,this)}}),tomtom.BaseObject}),function(e,t){function tt(e,t,n,r){n=n||[],t=t||m;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=q.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return E.apply(n,S.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Y&&t.getElementsByClassName)return E.apply(n,S.call(t.getElementsByClassName(f),0)),n}return dt(e.replace(B,"$1"),t,n,r,a)}function nt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function it(e){return T(function(t){return t=+t,T(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function st(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ot(e,t){var n,r,s,o,u,a,f,l=k[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=j.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=F.exec(u))s.push(n=new v(r.shift())),u=u.slice(n.length),n.type=r[0].replace(B," ");for(o in i.filter)(r=$[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new v(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?tt.error(e):k(e,a).slice(0)}function ut(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=b++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=y+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function at(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function ft(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function lt(e,t,n,r,i,s){return r&&!r[d]&&(r=lt(r)),i&&!i[d]&&(i=lt(i,s)),T(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||pt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?ft(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=ft(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?x.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=ft(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):E.apply(o,g)})}function ct(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=ut(function(e){return e===t},u,!0),l=ut(function(e){return x.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[ut(at(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return lt(a>1&&at(h),a>1&&e.slice(0,a-1).join("").replace(B,"$1"),n,a<r&&ct(e.slice(a,r)),r<s&&ct(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return at(h)}function ht(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,g=[],b=0,S="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=y+=N==null?1:Math.E;T&&(c=a!==m&&a,n=o.el);for(;(p=C[S])!=null;S++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(y=k,n=++o.el)}r&&((p=!v&&p)&&b--,u&&x.push(p))}b+=S;if(r&&S!==b){for(d=0;v=t[d];d++)v(x,g,a,f);if(u){if(b>0)while(S--)!x[S]&&!g[S]&&(g[S]=w.call(l));g=ft(g)}E.apply(l,g),T&&!u&&g.length>0&&b+t.length>1&&tt.uniqueSort(l)}return T&&(y=k,c=N),x};return o.el=0,r?T(o):o}function pt(e,t,n){var r=0,i=t.length;for(;r<i;r++)tt(e,t[r],n);return n}function dt(e,t,n,r,s){var o,u,f,l,c,h=ot(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace(V,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=$.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace(V,""),U.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return E.apply(n,S.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,U.test(e)),n}function vt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),v=String,m=e.document,g=m.documentElement,y=0,b=0,w=[].pop,E=[].push,S=[].slice,x=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},T=function(e,t){return e[d]=t==null||t,e},N=function(){var e={},t=[];return T(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},C=N(),k=N(),L=N(),A="[\\x20\\t\\r\\n\\f]",O="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",M=O.replace("w","w#"),_="([*^$|!~]?=)",D="\\["+A+"*("+O+")"+A+"*(?:"+_+A+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+A+"*\\]",P=":("+O+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+D+")|[^:]|\\\\.)*|.*))\\)|)",H=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+A+"*((?:-\\d)?\\d*)"+A+"*\\)|)(?=[^-]|$)",B=new RegExp("^"+A+"+|((?:^|[^\\\\])(?:\\\\.)*)"+A+"+$","g"),j=new RegExp("^"+A+"*,"+A+"*"),F=new RegExp("^"+A+"*([\\x20\\t\\r\\n\\f>+~])"+A+"*"),I=new RegExp(P),q=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,R=/^:not/,U=/[\x20\t\r\n\f]*[+~]/,z=/:not\($/,W=/h\d/i,X=/input|select|textarea|button/i,V=/\\(?!\\)/g,$={ID:new RegExp("^#("+O+")"),CLASS:new RegExp("^\\.("+O+")"),NAME:new RegExp("^\\[name=['\"]?("+O+")['\"]?\\]"),TAG:new RegExp("^("+O.replace("w","w*")+")"),ATTR:new RegExp("^"+D),PSEUDO:new RegExp("^"+P),POS:new RegExp(H,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+A+"*(even|odd|(([+-]|)(\\d*)n|)"+A+"*(?:([+-]|)"+A+"*(\\d+)|))"+A+"*\\)|)","i"),needsContext:new RegExp("^"+A+"*[>+~]|"+H,"i")},J=function(e){var t=m.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},K=J(function(e){return e.appendChild(m.createComment("")),!e.getElementsByTagName("*").length}),Q=J(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),G=J(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Y=J(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),Z=J(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",g.insertBefore(e,g.firstChild);var t=m.getElementsByName&&m.getElementsByName(d).length===2+m.getElementsByName(d+0).length;return r=!m.getElementById(d),g.removeChild(e),t});try{S.call(g.childNodes,0)[0].nodeType}catch(et){S=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}tt.matches=function(e,t){return tt(e,null,null,t)},tt.matchesSelector=function(e,t){return tt(t,null,null,[e]).length>0},s=tt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=tt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=tt.contains=g.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:g.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},tt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||G?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=tt.selectors={cacheLength:50,createPseudo:T,match:$,attrHandle:Q?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:K?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:Z&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Y&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(V,""),e[3]=(e[4]||e[5]||"").replace(V,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||tt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&tt.error(e[0]),e},PSEUDO:function(e){var t,n;if($.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])I.test(t)&&(n=ot(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace(V,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace(V,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace(V,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=C[d][e+" "];return t||(t=new RegExp("(^|"+A+")"+e+"("+A+"|$)"))&&C(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=tt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||tt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?T(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=x.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:T(function(e){var t=[],n=[],r=a(e.replace(B,"$1"));return r[d]?T(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:T(function(e){return function(t){return tt(e,t).length>0}}),contains:T(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return W.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:nt("radio"),checkbox:nt("checkbox"),file:nt("file"),password:nt("password"),image:nt("image"),submit:rt("submit"),reset:rt("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return X.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:it(function(){return[0]}),last:it(function(e,t){return[t-1]}),eq:it(function(e,t,n){return[n<0?n+t:n]}),even:it(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:it(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:it(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:it(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=g.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return st(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return st(i[f],s[f]);return f===n?st(e,s[f],-1):st(i[f],t,1)},[0,0].sort(f),h=!l,tt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},tt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=tt.compile=function(e,t){var n,r=[],i=[],s=L[d][e+" "];if(!s){t||(t=ot(e)),n=t.length;while(n--)s=ct(t[n]),s[d]?r.push(s):i.push(s);s=L(e,ht(i,r))}return s},m.querySelectorAll&&function(){var e,t=dt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.oMatchesSelector||g.msMatchesSelector;J(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+A+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),J(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+A+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),dt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ot(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=U.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return E.apply(s,S.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(J(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",P)}catch(n){}}),s=new RegExp(s.join("|")),tt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return tt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=vt.prototype=i.pseudos,i.setFilters=new vt,typeof define=="function"&&define.amd?define("sizzle",[],function(){return tt}):e.Sizzle=tt}(window),define("tomtom/dom/DomUtilResult",["../BaseObject","../Utils"],function(e,t){return tomtom.dom.DomUtilResult=e.extend({initialize:function(e,t){this.elements=e,this.du=t},html:function(e){if(e==null){var t=this.first();return t?t.innerHTML:null}return this.du.html(this.elements,e),this},css:function(e,t){if(t==null){var n=this.first();return n?this.du.css(n,e):null}this.each(this.hitch(function(n){this.du.css(n,e,t)}))},append:function(e){if(typeof e=="string")this.each(function(t){t.innerHTML+=e});else{var t=this.first();t&&this.du.each(e,function(e){t.appendChild(e)})}return this},first:function(){return this.get(0)},get:function(e){return e==null&&(e=0),this.elements.length>e?this.elements[e]:null},each:function(e,t){return this.du.each(this.elements,e,t),this},val:function(e){if(e==undefined){var t=this.first();return t&&t.value?t.value:""}return this.du.val(this.elements,e),this},find:function(e){return this.du.query(e,this.elements)},on:function(e,t,n){return this.du.on(this.elements,e,t,n)},off:function(e,t){return this.du.off(this.elements,e,t)},attr:function(e,t){return this.du.attr(this.elements,e,t)},data:function(e,t){return this.du.data(this.elements,e,t)},removeAttr:function(e){return this.du.removeAttr(this.elements,e),this},next:function(e){return this.du.next(this.first(),e)},prev:function(e){return this.du.prev(this.first(),e)},children:function(e){return this.du.children(this.elements,e)},length:function(){return this.elements.length},addClass:function(e){return this.du.addClass(this.elements,e),this},removeClass:function(e){return this.du.removeClass(this.elements,e),this},offset:function(){return this.du.offset(this.first())},position:function(){return this.du.position(this.first())},offsetHeight:function(){var e=this.first();return e?e.offsetHeight:null},offsetWidth:function(){var e=this.first();return e?e.offsetWidth:null},height:function(){var e=this.first();return e?e.clientHeight:null},width:function(){var e=this.first();return e?e.clientWidth:null},empty:function(){return this.each(function(e){this.du.empty(e)},this),this},hide:function(){return this.each(function(e){this.css("display","none")},this),this},show:function(){return this.each(function(e){this.css("display","block")},this),this},parents:function(){return this.du.parents(this)},hasClass:function(e){return this.du.hasClass(this,e)}}),tomtom.dom.DomUtilResult}),define("tomtom/dom/DomUtil",["../BaseObject","sizzle","./DomUtilResult","../Utils"],function(e,t,n,r){var e=L.Util.extend({},L.DomUtil);return tomtom.dom.DomUtil=L.Util.extend(e,{initialize:function(){},query:function(e,i){if(r.isArray(i)){var s=[];return i.forEach(function(n){t(e,n,s)}),new n(s,this)}return new n(t(e,i),this)},css:function(e,t,n){if(!e.style)return;if(typeof n=="undefined")return e.style[t];e.style[t]=n},offset:function(e){var t=0,n=0;do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{top:n,left:t}},empty:function(e){while(e.children.length>0)e.removeChild(e.children[0]);return new n(e,this)},html:function(e,t){return this.each(e,function(e){typeof t=="string"||typeof t=="number"?e.innerHTML=t:(this.empty(e),e.appendChild(t))}),new n(e,this)},append:function(e,t){return this.each(e,function(e){typeof t=="string"?e.innerHTML+=t:e.appendChild(t)}),new n(e,this)},attr:function(e,t,r){return typeof r=="undefined"?this.first(e).getAttribute(t):(this.each(e,function(e){e.setAttribute(t,r)}),new n(e,this))},removeAttr:function(e,t){return this.each(e,function(e){e.removeAttribute(t)}),new n(e,this)},data:function(e,t,r){if(typeof r!="undefined")return this.each(e,function(e){e._ttData||(e._ttData={}),e._ttData[t]=r}),new n(e,this);var i=this.first(e);return i?i._ttData[t]:null},val:function(e,t){if(typeof t=="undefined"){var r=this.first(e);return r?r.value:""}return this.each(e,function(e){e.value=t}),new n(e,this)},_nlToArray:function(e){var t=[];for(var n=e.length;n--;t.unshift(e[n]));return t},next:function(e,r){var i=this.first(e),s=i.parentNode,o=this._nlToArray(s.childNodes),u=o.indexOf(i);if(u==-1)return null;if(u<o.length){var e=o.splice(u+1,o.length-u);return r?new n(t.matches(r,e),this):new n(e,this)}return new n([],this)},prev:function(e,r){var i=this.first(e),s=i.parentNode,o=this._nlToArray(s.childNodes),u=o.indexOf(i);if(u>0){var e=o.splice(0,u);return e.reverse(),r?new n(t.matches(r,e),this):new n(e,this)}return new n([],this)},children:function(e,r){return r?new n(t.matches(r,this.first(e).childNodes),this):new n(this.first(e).childNodes,this)},viewport:function(){return{width:window.innerWidth,height:window.innerHeight}},removeClass:function(e,t){return this.each(e,function(e){L.DomUtil.removeClass(e,t)}),new n(e,this)},addClass:function(e,t){return this.each(e,function(e){L.DomUtil.addClass(e,t)}),new n(e,this)},isNodeList:function(e){return typeof e.length=="number"&&typeof e.item!="undefined"},dimensions:function(e){return{width:e.clientWidth,height:e.clientHeight,outerWidth:e.offsetWidth,outerHeight:e.offsetHeight}},on:function(e,t,r,i){return this.each(e,function(e){L.DomEvent.on(e,t,r,i)}),new n(e,this)},off:function(e,t,r){return this.each(e,function(e){L.DomEvent.off(e,t,r)}),new n(e,this)},create:function(e,t){var r=e;return t||(t=""),typeof e=="string"&&(r=L.DomUtil.create.apply(this,[e,t])),new n([r],this)},each:function(e,t,n){e.du&&e.elements&&(e=e.elements);if(!r.isArray(e)&&!this.isNodeList(e))return t.apply(n,[e,0]),this;for(var i=0;i<e.length;i++){var s=t.apply(n?n:this,[e[i],i]);if(s===!1)break}},first:function(e){return!r.isArray(e)&&!this.isNodeList(e)?e:e[0]},parents:function(e){var t=[];return this.each(e,function(e,n){var r=e.parentNode;while(r!=null)t.push(r),r=r.parentNode},this),new n(t,this)},hasClass:function(e,t){var n=!1;return this.each(e,function(e){if(e.className&&L.DomUtil.hasClass(e,t))return n=!0,!1},this),n}}),tomtom.dom.DomUtil}),define("tomtom/Logger",["./Main"],function(){return tomtom.Logger=L.Class.extend({initialize:function(){},info:function(){this._log("info",arguments)},debug:function(){this._log("debug",arguments)},log:function(){this._log("log",arguments)},error:function(){this._log("error",arguments)},warn:function(){this._log("warn",arguments)},_log:function(e,t){if(!tomtom.isDebugMode&&(e=="log"||e=="debug"))return;if(typeof console!="undefined"){var n=console[e];n?n.apply?n.apply(console,t):n(t[0]):n!="log"&&this._log("log",t)}}}),tomtom.Logger}),define("tomtom/services/BaseService",["../BaseObject","../Logger"],function(e,t){return tomtom.services.BaseService=e.extend({initialize:function(n){this.log=new t,e.prototype.initialize.apply(this,[]),n?this.apiKey=n:this.apiKey=tomtom.apiKey,!this.apiKey&&!tomtom.proxyUrl&&this.log.warn('An API Key has not been specified.  TomTom services will not work without an API Key. Please specify an API key either via tomtom.apiKey OR by passing the apiKey to the service\'s constructor: var service = new tomtom.services.GeocodeService("your key here");')}}),tomtom.services.BaseService}),define("tomtom/AjaxUtil",["./Main"],function(){tomtom.AjaxUtil={getJSON:function(e){var t;window.XMLHttpRequest?t=new XMLHttpRequest:t=new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){t.readyState==4&&t.status==200&&e.callback(JSON.parse(t.responseText))},t.open("GET",e.url,!0),t.send()},getJSONP:function(t){e.get(t.url,t.data,t.callback,t.callbackParam)}};var e=function(){function o(e){var n=document.createElement("script"),r=!1;n.src=e,n.async=!0,n.onload=n.onreadystatechange=function(){!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(r=!0,n.onload=n.onreadystatechange=null,n&&n.parentNode&&n.parentNode.removeChild(n))},t||(t=document.getElementsByTagName("head")[0]),t.appendChild(n)}function u(e){return encodeURIComponent(e)}function a(t,a,f,l){n=(t||"").indexOf("?")===-1?"?":"&",a=a||{};for(r in a)a.hasOwnProperty(r)&&(n+=u(r)+"="+u(a[r])+"&");var c="json"+ ++e;return i[c]=function(e){f(e);try{delete i[c]}catch(t){}i[c]=null},o(t+n+(l||s.callbackName||"callback")+"="+c),c}function f(e){s=e}var e=0,t,n,r,i=this,s={};return{get:a,init:f}}();return tomtom.AjaxUtil}),define("tomtom/services/InitializeService",["./BaseService","../Utils","../AjaxUtil"],function(e,t,n){tomtom.services.InitializeService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},getCopyrightInfo:function(e,i){typeof e=="function"&&(i=e,e={}),this.apiKey&&(e.key=this.apiKey),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(r,e),callback:i}):n.getJSONP({url:t.getServiceUrl(r+"p",e),callback:i,callbackParam:"jsonp"})}});var r="lbs/services/initialize/3/json";return tomtom.services.InitializeService}),define("tomtom/services/ViewportService",["./BaseService","../AjaxUtil","../Utils"],function(e,t,n){tomtom.services.ViewportService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},getViewportModel:function(e,s,o,u,a,f){typeof a=="function"&&(f=a,a={}),a.projection||(a.projection="EPSG4326");var l=new L.LatLng(e.top,e.right,!0),c=new L.LatLng(e.bottom,e.left,!0),h=new L.LatLng(o.top,o.right,!0),p=new L.LatLng(o.bottom,o.left,!0);if(a.projection=="EPSG4326"){var d=L.CRS.EPSG3857;l=d.project(l),c=d.project(c),h=d.project(h),p=d.project(p)}else l=new L.Point(l.lng,l.lat),c=new L.Point(c.lng,c.lat),h=new L.Point(h.lng,h.lat),p=new L.Point(p.lng,p.lat);var v=c.x,m=c.y,g=l.x,y=l.y;v=v<r.minX?r.minX:v,m=m<r.minY?r.minY:m,g=g>r.maxX?r.maxX:g,y=y>r.maxY?r.maxY:y;var b=p.x<r.minX?r.minX:p.x,w=p.y<r.minY?r.minY:p.y,E=h.x>r.maxX?r.maxX:h.x,S=h.y>r.maxY?r.maxY:h.y,x={box:m+","+v+","+y+","+g,zoom:s,overviewBox:w+","+b+","+S+","+E,overviewZoom:u,copyright:typeof a.copyright=="undefined"?!0:a.copyright};this.apiKey&&(a.key=this.apiKey),tomtom.proxyUrl?t.getJSON({url:n.getServiceUrl(L.Util.template(i,x),a),callback:f}):t.getJSONP({url:n.getServiceUrl(L.Util.template(i+"p",x),a),callback:f,callbackParam:"jsonp"})}});var r={minX:-40075016.6855784,minY:-40075016.6855784,maxX:40075016.6855784,maxY:40075016.6855784},i="lbs/services/viewportDesc/3/{box}/{zoom}/{overviewBox}/{overviewZoom}/{copyright}/json";return tomtom.services.ViewportService}),define("tomtom/services/RoutingService",["./BaseService","../AjaxUtil","../Utils"],function(e,t,n){tomtom.services.RoutingService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},getRoute:function(e,s,o){typeof s=="function"&&(o=s,s={}),this.apiKey&&(s.key=this.apiKey);var u=L.Util.extend({},s);u.routeType&&delete u.routeType,s.routeType||(s.routeType=i),u.language||(u.language=tomtom.LocaleManager.getPrimaryLanguage());var a=[];for(var f=0;f<e.length;f++){var l=L.latLng(e[f]);a.push(l.lat+","+l.lng)}var c={points:a.join(":"),routeType:s.routeType};tomtom.proxyUrl?t.getJSON({url:n.getServiceUrl(L.Util.template(r,c),u),callback:o}):t.getJSONP({url:n.getServiceUrl(L.Util.template(r+"p",c),u),callback:o,callbackParam:"jsonp"})}});var r="lbs/services/route/3/{points}/{routeType}/json",i="Quickest";return tomtom.services.RoutingService}),define("tomtom/services/GeocodingService",["./BaseService","../Utils","../AjaxUtil"],function(e,t,n){tomtom.services.GeocodingService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},geocode:function(e,i,s){typeof i=="function"&&(s=i,i={});var o={format:tomtom.proxyUrl?"json":"jsonp"};typeof e=="string"?o.query=e:o=L.Util.extend(o,e),this.apiKey&&(o.key=this.apiKey),o=L.Util.extend(o,i),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(r,o),callback:s}):n.getJSONP({url:t.getServiceUrl(r,o),callback:s,callbackParam:"callback"})},reverseGeocode:function(e,r,s,o){if(isNaN(r)){o=s,s=r;var u=L.latLng(e);e=u.lat,r=u.lng}typeof s=="function"&&(o=s,s={});var a={point:e+","+r,projection:"EPSG4326"};a=L.Util.extend(a,s),this.apiKey&&(a.key=this.apiKey),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(i,a),callback:o}):n.getJSONP({url:t.getServiceUrl(i+"p",a),callback:o,callbackParam:"jsonp"})}});var r="lbs/services/geocode/4/geocode",i="lbs/services/reverseGeocode/3/json";return tomtom.services.GeocodingService}),define("tomtom/layers/MapLayer",["../Main","../Utils"],function(e,t){return tomtom.layers.MapLayer=L.TileLayer.extend({initialize:function(e){typeof e=="undefined"&&(e={}),e.apiKey||(e.apiKey=tomtom.apiKey);var n=t.getServiceUrl("lbs/map/3/basic/1/{z}/{x}/{y}.png");if(typeof tomtom.enableHostCycling=="undefined"||tomtom.enableHostCycling)n=n.replace(/https?:\/\//g,"http://{s}.");tomtom.proxyUrl||(n+="?key={apiKey}"),L.TileLayer.prototype.initialize.apply(this,[n,e])}}),tomtom.layers.MapLayer}),define("tomtom/layers/TrafficLayer",["../Utils","../Main"],function(e){tomtom.layers.TrafficLayer=L.TileLayer.extend({initialize:function(e,n){typeof options=="undefined"&&(options={});var r=e;L.TileLayer.prototype.initialize.apply(this,[t,{apiKey:r,trafficModel:n}])},update:function(e){this.options.trafficModel!=e&&(this.options.trafficModel=e,this.redraw())},setTrafficModel:function(e){this.options.trafficModel=e}});var t="http://{s}.api.tomtom.com/lbs/map/3/traffic/s2/{z}/{x}/{y}.png?t={trafficModel}&key={apiKey}";return tomtom.layers.TrafficLayer}),define("tomtom/Animation",["./dom/DomUtil","./Utils","./Main"],function(e,t){function n(e){return e}function r(e){return Math.pow(e,2)}function i(e){for(var t=0,n=1,r;1;t+=n,n/=2)if(e>=(7-4*t)/11)return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)}function s(e){return function(t){return 1-e(1-t)}}tomtom.Animation=L.Class.extend({initialize:function(e,t,n){this.element=L.DomUtil.get(e),this.effect=t,this.options=n,this.options||(this.options={}),this.options.duration||(this.options.duration=o),this._originalPosition=L.DomUtil.getPosition(e)},dropIn:function(){var t=this.element,n=L.DomUtil.getPosition(t),r=this.options.height;return r||(r=t.offsetHeight*10),L.DomUtil.setPosition(t,{x:n.x,y:n.y-r}),e.css(t,"display","none"),function(){e.css(t,"display","block"),this.animate({delta:s(i),step:function(e){L.DomUtil.setPosition(t,{x:n.x,y:n.y*e})}})}},bounce:function(){var t=this.element,n=L.DomUtil.getPosition(t),o=this.options.height;return this.options.duration=this.options.duration/2,o||(o=t.offsetHeight*5),e.css(t,"display","none"),function(){e.css(t,"display","block"),this.animate({delta:s(r),step:function(e){L.DomUtil.setPosition(t,{x:n.x,y:n.y-Math.abs(n.y-(n.y-o))*e})},callback:L.Util.bind(function(){if(this._cancel)return;L.DomUtil.setPosition(t,{x:n.x,y:n.y-o}),n=L.DomUtil.getPosition(t),this.animate({delta:s(i),step:L.Util.bind(function(e){if(this._cancel)return;L.DomUtil.setPosition(t,{x:n.x,y:n.y+Math.abs(n.y-(n.y+o))*e})},this)})},this)})}},fadeIn:function(){var e=this.element,t=L.DomUtil.getPosition(e);return L.DomUtil.setOpacity(e,0),function(){this.animate({delta:s(n),step:L.Util.bind(function(t){if(this._cancel)return;L.DomUtil.setOpacity(e,t)},this)})}},fadeOut:function(){var e=this.element,t=L.DomUtil.getPosition(e);return L.DomUtil.setOpacity(e,1),function(){this.animate({delta:s(n),step:L.Util.bind(function(t){if(this._cancel)return;L.DomUtil.setOpacity(e,1-t)},this)})}},play:function(){var e=this[this.effect];if(e&&typeof e=="function"){if(this.element.style.display=="none")return;this.animationTimeoutId&&clearTimeout(this.animationTimeoutId);var t=e.apply(this,[]);this.options.delay?this.animationTimeoutId=setTimeout(L.Util.bind(function(){t.apply(this,[])},this),this.options.delay):t.apply(this,[])}},stop:function(){this._cancel=!0,clearInterval(this._animationInterval),clearTimeout(this.animationTimeoutId),this.element.style.display="block",L.DomUtil.setPosition(this.element,this._originalPosition)},animate:function(e){var t=new Date,n=setInterval(L.Util.bind(function(){var r=new Date-t,i=r/this.options.duration;i>1&&(i=1);var s=e.delta(i);e.step(s),i==1&&(clearInterval(n),e.callback?e.callback():this.options.callback&&this.options.callback())},this),u);this._animationInterval=n}});var o=500,u=25;return tomtom.Animation}),define("tomtom/Marker",["./Main","./Animation","./dom/DomUtil"],function(e,t,n){tomtom.Marker=L.Marker.extend({initialize:function(e,t,n){n||(n={});if(!n.icon){t?t=L.Util.extend({},t):t=L.Util.extend({},tomtom.Marker.DEFAULT_MARKER_OPTIONS);var r=t.iconUrl;r&&r.indexOf("http://")!=0&&r.indexOf("https://")!=0&&r.indexOf("/")!=0&&(t.iconUrl=tomtom.baseImagePath+t.iconUrl),n.icon=L.icon(t)}L.Marker.prototype.initialize.apply(this,[e,n])},onAdd:function(e){L.Marker.prototype.onAdd.apply(this,arguments),this.contextMenu&&(this.contextMenu.map||this.contextMenu.onAdd(e),this._icon&&this.contextMenu.addTarget(this._icon,this))},setContextMenu:function(e){this.contextMenu&&this.contextMenu.destroy(),this.contextMenu=e,this._icon&&e.addTarget(this._icon,this),this._map&&!e.map&&e.onAdd(this._map)},animate:function(e,n){if(!this._currentAnimation){var r=n.callback;n.callback=L.Util.bind(function(){this._currentAnimation=null,r&&r()},this);var i=new t(this._icon,e,n);i.play(),this._currentAnimation=i}},stopAnimation:function(){var e=this._currentAnimation;e&&e.stop(),this._currentAnimation=null},bindPopup:function(e,t){t&&t.showOnMouseOver?(L.Marker.prototype.bindPopup.apply(this,[e,t]),this.off("click",this.openPopup,this),this.on("mouseover",function(e){var t=e.originalEvent.fromElement||e.originalEvent.relatedTarget,n=this._getParent(t,"leaflet-popup");if(n==this._popup._container)return!0;this.openPopup()},this),this.on("mouseout",function(e){var t=e.originalEvent.toElement||e.originalEvent.relatedTarget;if(this._getParent(t,"leaflet-popup"))return L.DomEvent.on(this._popup._container,"mouseout",this._popupMouseOut,this),!0;this.closePopup()},this)):L.Marker.prototype.bindPopup.apply(this,arguments)},_popupMouseOut:function(e){L.DomEvent.off(this._popup,"mouseout",this._popupMouseOut,this);var t=e.toElement||e.relatedTarget;if(this._getParent(t,"leaflet-popup"))return!0;if(t==this._icon)return!0;this.closePopup()},_getParent:function(e,t){var n=e.parentNode;while(n!=null){if(n.className&&L.DomUtil.hasClass(n,t))return n;n=n.parentNode}return!1}}),tomtom.Marker.DEFAULT_MARKER_OPTIONS={iconUrl:"marker.png",iconSize:[51,60],iconAnchor:[21,49],popupAnchor:[0,-49]};var r=250;return tomtom.Marker}),define("tomtom/CustomDivIcon",[],function(){return tomtom.CustomDivIcon=L.DivIcon.extend({_setIconStyles:function(e,t){e.className="leaflet-marker-"+t+" "+this.options.className}}),tomtom.CustomDivIcon}),define("tomtom/CustomMarker",["./Main","./Marker","./dom/DomUtil","./CustomDivIcon"],function(e,t,n,r){return tomtom.CustomMarker=tomtom.Marker.extend({initialize:function(e,t,n){n||(n={}),n.icon=new r({className:t,html:n.html,iconSize:null}),tomtom.Marker.prototype.initialize.apply(this,[e,null,n])},setClassName:function(e){this._icon.className=e},setHTML:function(e){n.html(this._icon,e)}}),tomtom.CustomMarker}),define("tomtom/TrafficMarker",["./CustomMarker","sizzle"],function(e,t){tomtom.TrafficMarker=tomtom.CustomMarker.extend({initialize:function(e,t){this.incidentType=tomtom.TrafficMarker.getTypeString(t.ty),this.iconCategory=tomtom.TrafficMarker.getCategoryString(t.ic),this.clusterSize=t.cs,this._incident=t,this.clusterSize&&this.iconCategory!="region"&&(this.iconCategory="cluster"),tomtom.CustomMarker.prototype.initialize.apply(this,[e,"trafficIcon"])},onAdd:function(e){tomtom.CustomMarker.prototype.onAdd.apply(this,arguments),this.configureIcon(),this.off("mouseover",this._onMouseOver),this.off("mouseout",this._onMouseOut),this.on("mouseover",this._onMouseOver,this),this.on("mouseout",this._onMouseOut,this)},onRemove:function(e){tomtom.CustomMarker.prototype.onRemove.apply(this,arguments),this.off("mouseover",this._onMouseOver),this.off("mouseout",this._onMouseOut)},configureIcon:function(){var e=this.iconCategory,t=this.incidentType,n=this._icon;this.setBackgroundImage("traffic-icons/"+e+"-"+t+".png"),this._icon.id="traffic_incident_"+this._incident.id,e=="cluster"||e=="region"?(L.DomUtil.addClass(this._icon,"trafficIcon-cluster"),this._icon.innerHTML=this.clusterSize,e=="region"&&L.DomUtil.addClass(this._icon,"trafficIcon-region"),this._configureClusterPopup()):this._configurePopup()},setBackgroundImage:function(e){this._icon.style.backgroundImage='url("'+tomtom.baseImagePath+e+'")'},_onMouseOut:function(){L.DomUtil.removeClass(this._icon,"trafficIcon-hover")},_onMouseOver:function(){L.DomUtil.addClass(this._icon,"trafficIcon-hover")},_configurePopup:function(){this.bindPopup(this._getIncidentMarkup(this._incident))},_getIncidentMarkup:function(e){var t=tomtom.baseImagePath,r=new tomtom.StringBundle("IncidentItem"),i=L.Util.extend({r:"",dl:"--",l:"--",d:"",f:"--",t:"--",icon:"url("+t+"traffic-icons/"+tomtom.TrafficMarker.getCategoryString(e.ic)+"-"+tomtom.TrafficMarker.getTypeString(e.ty)+".png)",labelDelay:r.getString("delay"),labelLength:r.getString("length"),labelFrom:r.getString("from"),labelTo:r.getString("to")},e);return i.dl&&!isNaN(i.dl)&&(i.dl=Math.round(i.dl/60),i.dl+=" "+tomtom.StringBundle.getString("units.time.minute",null,i.dl)),i.l&&!isNaN(i.l)&&(i.l=tomtom.StringBundle.getString("units.distance",null,i.l)),L.Util.template(n,i)},_configureClusterPopup:function(){var e=tomtom.baseImagePath,t=0,n="",o=new tomtom.StringBundle("IncidentBalloon.Cluster"),u=this._incident,a=this.pois=u.cpoi.sort(function(e,t){return e.dl>t.dl?-1:e.dl==t.dl?0:1});this._pois=a;for(var f=0;f<a.length&&f<4;f++){var l=a[f],c="";l.f&&l.f.length>s&&(l.f=l.f.substring(0,s)+"..."),l.t&&l.t.length>s&&(l.t=l.t.substring(0,s)+"..."),f+1==a.length&&(c="last");var h=L.Util.extend({r:"",dl:"--",l:"--",d:"",f:"--",t:"--",index:f,className:c,icon:"url("+e+"traffic-icons/"+tomtom.TrafficMarker.getCategoryString(l.ic)+"-"+tomtom.TrafficMarker.getTypeString(l.ty)+".png)"},l);h.dl&&!isNaN(h.dl)&&(h.dl=Math.round(h.dl/60),h.dl+=" "+tomtom.StringBundle.getString("units.time.minute",null,h.dl)),h.l&&!isNaN(h.l)&&(h.l=tomtom.StringBundle.getString("units.distance",null,h.l)),n+=L.Util.template(i,h),t++}var p=L.Util.template(r,{incidentCount:this._incident.cs,labelIncidents:o.getString("title"),mostSevereIncidents:o.getString("listHeader",{count:t},t),orderedBy:o.getString("orderedByDelay"),incidents:n});this.bindPopup(p)},openPopup:function(){tomtom.CustomMarker.prototype.openPopup.apply(this,arguments);var e=L.Util.bind(function(e,t){var n=parseInt(t.getAttribute("data-poi-index")),r=null,i=this._pois;isNaN(n)||(r=i[n]),r&&this._showIncidentPopup(r),L.DomEvent.stopPropagation(e)},this),n=t(".trafficInfo-cluster tr",this._popup._contentNode);for(var r=0;r<n.length;r++){var i=n[r];L.DomEvent.on(i,"click",function(t){e(t,this)})}},_showIncidentPopup:function(e){var t=L.point(this.options.popupAnchor)||new L.Point(0,0);t=t.add(L.Popup.prototype.options.offset);var n={offset:t},r=(new L.Popup(n,this)).setContent(this._getIncidentMarkup(e));return r.setLatLng(this._latlng),this._map.openPopup(r),r}}),tomtom.TrafficMarker.getTypeString=function(e){switch(e){case 1:return"minor";case 2:return"moderate";case 3:return"major";default:return"unknown"}},tomtom.TrafficMarker.getCategoryString=function(e){switch(e){case 1:return"accdnt";case 2:case 3:case 4:case 5:case 10:case 11:case 12:return"block";case 7:case 8:return"closed";case 9:return"rworks";case 13:return"cluster";case 999:return"region";default:return"traffic"}};var n='<div class="trafficInfo"><div class="header"><div style="background-image: {icon}" class="icon"></div><div class="road">{r}</div><div class="delay"><label>{labelDelay}:</label>{dl}</div><div class="length"><label>{labelLength}:</label>{l}</div></div><div class="body"><div class="description">{d}</div><div class="location"><div class="line"><label>{labelFrom}:</label><div>{f}</div></div><div class="line"><label>{labelTo}:</label><div>{t}</div></div></div></div></div>',r='<div class="trafficInfo trafficInfo-cluster"><div class="header">{labelIncidents} {incidentCount}</div><h3>{mostSevereIncidents} <span>{orderedBy}</span></h3><table>{incidents}</table></div>',i='<tr class="{className}" data-poi-index="{index}"><td><div class="icon" style="background-image: {icon}"></div></td><td class="location"><div class="from">{f}</div><div class="to">{t}</div></td><td class="delay">{dl}</td><td class="length">{l}</td>',s=18;return tomtom.TrafficMarker}),define("tomtom/i18n",["./Utils","./Main"],function(e){function l(e,t){if(e&&e.indexOf(".")>-1){var n=e.split("."),r=n.length-1;for(var i=0;i<r&&t;i++)t=t[n[i]];return e=n[i],t&&t[e]||undefined}return t[e]}var t=/{([\w_]+)}/g,n=/^([a-z]{2})([-_])([a-z]{2})/i,r=/;; ?/,i=null,s={},o=null,u="en_US",a={_rules:[[1,function(e){return 0}],[2,function(e){return e!=1?1:0}],[2,function(e){return e>1?1:0}],[3,function(e){return e%10==1&&e%100!=11?1:e!=0?2:0}],[4,function(e){return e==1||e==11?0:e==2||e==12?1:e>0&&e<20?2:3}],[3,function(e){return e==1?0:e==0||e%100>0&&e%100<20?1:2}],[3,function(e){return e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?2:1}],[3,function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}],[3,function(e){return e==1?0:e>=2&&e<=4?1:2}],[3,function(e){return e==1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}],[4,function(e){return e%100==1?0:e%100==2?1:e%100==3||e%100==4?2:3}],[5,function(e){return e==1?0:e==2?1:e>=3&&e<=6?2:e>=7&&e<=10?3:4}],[6,function(e){return e==0?5:e==1?0:e==2?1:e%100>=3&&e%100<=10?2:e%100>=11&&e%100<=99?3:4}],[4,function(e){return e==1?0:e==0||e%100>0&&e%100<=10?1:e%100>10&&e%100<20?2:3}],[3,function(e){return e%10==1?0:e%10==2?1:2}],[2,function(e){return e%10==1&&e%100!=11?0:1}]],_languages:{"hu-HU":0,"id-ID":0,"ms-MY":0,"th-TH":0,"tr-TR":0,"zh-CN":0,"zh-TW":0,de:1,en:1,es:1,it:1,nl:1,pt:1,"af-ZA":1,"ca-ES":1,"da-DK":1,"de-DE":1,"en-GB":1,"en-US":1,"es-ES":1,"es-MX":1,"it-IT":1,"nl-BE":1,"nl-NL":1,"no-NO":1,"pt-BR":1,"pt-PT":1,"sv-SE":1,"et-EE":1,"fi-FI":1,"bg-BG":1,"el-GR":1,fr:2,"fr-CA":2,"fr-FR":2,"lv-LV":3,"lt-LT":6,"hr-HR":7,"ru-RU":7,"cs-CZ":8,"sk-SK":8,"pl-PL":9,"sl-SI":10},getPluralForm:function(e){var t=a._rules,i;if(isNaN(e)&&"string"==typeof e)if(e in a._languages)i=a._languages[e];else{var s=e.match(n);i=s&&a._languages[s[1]]}else i=Number(e);if(i==null||isNaN(i)||i<0||i>t.length)i=0;var o=t[i][1];return function(e,t){if("string"!=typeof e)return;t=isNaN(t)?1:t<0?0:t;var n=o(t),i=e?e.split(r):[""],s=n<i.length?i[n]:i[i.length-1];return s}}},f={_locale:"",getLocale:function(){return this._locale},setLocale:function(e){this._locale=e,o=a.getPluralForm(this._locale),i=tomtom.languages[this._locale]},getCountryCode:function(){var e=this._locale.match(n);return e&&e[3]||null},getPrimaryLanguage:function(){return this._locale.substr(0,2)},hasLocalizedStrings:function(){return"object"==typeof i&&i!=null},setLocaleRule:function(t,n,r){typeof r=="function"&&(e.isArray(t)||(t=[t]),t.forEach(function(e){s[e+"_"+n]=r},this))},getLocaleRule:function(e,t){typeof t=="undefined"&&(t=e,e=this.getLocale());var n=s[e+"_"+t];return n==null&&(n=s["*_"+t]),n}},c=L.Class.extend({initialize:function h(e,t){var n={},r,s;t&&(s=t._branch,this._pathKey=t._pathKey?t._pathKey+"."+e:e),s=s||i||h._branch||n,r=s==n?n:l(e,s),this._branch="object"==typeof r?r:null}});c._branch=null,c._pathKey="",c._pluralFormRule=null,c.getBranch=function(e){return new c(e,this)},c.getString=function(e,n,r){var s=this._branch||i||{},u=l(e,s),a=(this._pathKey?this._pathKey+".":"")+e,f=tomtom.LocaleManager.getLocaleRule(a);if(f)return f.apply(this.getBranch(a),[n,r]);var c=this._pluralFormRule||o;return c&&(u=c(u,r)),"string"==typeof u?(n&&(u=u.replace(t,function(e,t){return t in n?n[t]:"#"+t+"#"})),u):"#"+e+"#"},c.prototype._pathKey=c._pathKey,c.prototype._branch=c._branch,c.prototype.getBranch=c.getBranch,c.prototype.getString=c.getString,f.setLocale(u),f.setLocaleRule("*","units.distance",function(e,t){var n=t/1e3;return t<500?t+" "+this.getString("meter",null,t):n.toFixed(1)+" "+this.getString("km",null,n)}),f.setLocaleRule(["en_GB","en_US"],"units.distance",function(e,t){var n=Math.round(t*.10936133)*10,r=n/1760;return r<.5?Math.round(n)+" "+this.getString("yard",null,n):r.toFixed(1)+" "+this.getString("mile",null,r)}),f.setLocaleRule("*","common.TomTom.HDTraffic",function(){return"HD Traffic"}),tomtom.LocaleManager=f,tomtom.StringBundle=c,tomtom.PluralForm=a}),define("tomtom/services/TrafficService",["./BaseService","../AjaxUtil","../Utils","../i18n"],function(e,t,n){tomtom.services.TrafficService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},getTrafficModel:function(e,i,s,o){typeof s=="function"&&(o=s,s={}),s.projection||(s.projection="EPSG4326");var u=L.Util.extend({},s);s.trafficModelID||(s.trafficModelID=-1),delete u.trafficModelID,u.language||(u.language=tomtom.LocaleManager.getPrimaryLanguage()),s.zoom=i,s.minY=e.top,s.minX=e.left,s.maxY=e.bottom,s.maxX=e.right,this.apiKey&&(u.key=this.apiKey),u.expandCluster=!0,tomtom.proxyUrl?t.getJSON({url:n.getServiceUrl(L.Util.template(r,s),u),callback:o}):t.getJSONP({url:n.getServiceUrl(L.Util.template(r+"p",s),u),callback:o,callbackParam:"jsonp"})}});var r="lbs/services/trafficIcons/3/s2/{minY},{minX},{maxY},{maxX}/{zoom}/{trafficModelID}/json";return tomtom.services.TrafficService}),define("tomtom/layers/TrafficIncidentLayer",["../Utils","../TrafficMarker","../services/TrafficService"],function(e,t){return tomtom.layers.TrafficIncidentLayer=L.LayerGroup.extend({initialize:function(e,t){this.apiKey=e,this.trafficModel=t,this._updateTimeout=0,this._incidents={},L.LayerGroup.prototype.initialize.apply(this,[])},update:function(t,n){this.trafficModel=n,clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout(L.Util.bind(function(){typeof t=="undefined"&&(t=!0);var n=this._map.getZoom(),r=new tomtom.services.TrafficService(this.apiKey),i=this._map.getBounds();if(n>=7){var s=new Date;r.getTrafficModel({top:i.getNorthEast().lat,right:i.getNorthEast().lng,bottom:i.getSouthWest().lat,left:i.getSouthWest().lng},n,{projection:"EPSG4326",trafficModelID:this.trafficModel},L.Util.bind(function(t){if(t.tm&&t.tm.poi){var n=this.incidents=t.tm.poi;if(e.isArray(n))for(var r=0;r<n.length;r++)this._addMarker(n[r],s);else this._addMarker(n,s);this._map.fire("trafficupdate",{incidents:n});for(var i in this._incidents){var o=this._incidents[i];o._trafficIncidentUpdate!=s&&(this.removeLayer(o),delete this._incidents[i])}}},this))}else this.clearLayers()},this),250)},setTrafficModel:function(e){this.trafficModel=e},_addMarker:function(e,n){var r=this._incidents[e.id];r==null?(r=new t([e.p.y,e.p.x],e),this.addLayer(r)):(r.setLatLng([e.p.y,e.p.x]),r._incident=e,r._configurePopup()),r._trafficIncidentUpdate=n,this._incidents[e.id]=r}}),tomtom.layers.TrafficIncidentLayer}),L.Control.MiniMap=L.Control.extend({options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,zoomAnimation:!1,width:150,height:150},initialize:function(e,t){L.Util.setOptions(this,t),this._layer=e},onAdd:function(e){return this._mainMap=e,this._container=L.DomUtil.create("div","leaflet-control-minimap"),this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",L.DomEvent.disableClickPropagation(this._container),L.DomEvent.on(this._container,"mousewheel",L.DomEvent.stopPropagation),this._miniMap=new L.Map(this._container,{attributionControl:!1,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,touchZoom:!this.options.zoomLevelFixed,scrollWheelZoom:!this.options.zoomLevelFixed,doubleClickZoom:!this.options.zoomLevelFixed,boxZoom:!this.options.zoomLevelFixed}),this._miniMap.addLayer(L.Util.clone(this._layer)),this._mainMapMoving=!1,this._miniMapMoving=!1,this.options.toggleDisplay&&this._addToggleButton(),this._miniMap.whenReady(L.Util.bind(function(){this._aimingRect=L.rectangle(this._mainMap.getBounds(),{color:"#ff7800",weight:1,clickable:!1}).addTo(this._miniMap),this._mainMap.on("moveend",this._onMainMapMoved,this),this._mainMap.on("move",this._onMainMapMoving,this),this._miniMap.on("moveend",this._onMiniMapMoved,this)},this)),this._container},addTo:function(e){return L.Control.prototype.addTo.call(this,e),this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(!0)),this},onRemove:function(e){this._mainMap.off("moveend",this._onMainMapMoved,this),this._mainMap.off("move",this._onMainMapMoving,this),this._miniMap.off("moveend",this._onMiniMapMoved,this)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("","Hide","leaflet-control-minimap-toggle-display",this._container,this._toggleDisplay,this):undefined,this._minimized=!1},_createButton:function(e,t,n,r,i,s){var o=L.DomUtil.create("a",n,r);o.innerHTML=e,o.href="#",o.title=t;var u=L.DomEvent.stopPropagation;return L.DomEvent.on(o,"click",u).on(o,"mousedown",u).on(o,"dblclick",u).on(o,"click",L.DomEvent.preventDefault).on(o,"click",i,s),o},_toggleDisplay:function(){this._minimized?(this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace(/(?:^|\s)minimized(?!\S)/g,""),this._minimized=!1):(this._container.style.width="19px",this._container.style.height="19px",this._toggleDisplayButton.className+=" minimized",this._minimized=!0)},_onMainMapMoved:function(e){this._miniMapMoving?this._miniMapMoving=!1:(this._mainMapMoving=!0,this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(!0))),this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(e){this._aimingRect.setBounds(this._mainMap.getBounds())},_onMiniMapMoved:function(e){this._mainMapMoving?this._mainMapMoving=!1:(this._miniMapMoving=!0,this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(!1)))},_decideZoom:function(e){return this.options.zoomLevelFixed?e?this.options.zoomLevelFixed:this._mainMap.getZoom():e?this._mainMap.getZoom()+this.options.zoomLevelOffset:this._miniMap.getZoom()-this.options.zoomLevelOffset}}),L.Map.mergeOptions({miniMapControl:!1}),L.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new L.Control.MiniMap).addTo(this))}),L.control.minimap=function(e){return new L.Control.MiniMap(e)},L.Util.clone=function(e){if(e==null||typeof e!="object")return e;var t=new e.constructor;for(var n in e)t[n]=L.Util.clone(e[n]);return t},define("tomtom/lib/leaflet.minimap",function(){}),define("tomtom/controls/Pan",[],function(){return L.Control.Pan=L.Control.extend({options:{position:"topleft",panOffset:500},onAdd:function(e){var t="leaflet-control-pan",n=L.DomUtil.create("div",t),r=this.options.panOffset;return this._panButton("Up",t+"-up",n,e,new L.Point(0,-r)),this._panButton("Left",t+"-left",n,e,new L.Point(-r,0)),this._panButton("Right",t+"-right",n,e,new L.Point(r,0)),this._panButton("Down",t+"-down",n,e,new L.Point(0,r)),n},_panButton:function(e,t,n,r,i,s){var o=L.DomUtil.create("div",t+"-wrap"+" leaflet-bar",n),u=L.DomUtil.create("a",t,o);return u.href="#",u.title=e,L.DomEvent.on(u,"click",L.DomEvent.stopPropagation).on(u,"click",L.DomEvent.preventDefault).on(u,"click",function(){r.panBy(i)},r).on(u,"dblclick",L.DomEvent.stopPropagation),u}}),L.control.pan=function(e){return new L.Control.Pan(e)},L.Control.Pan}),define("tomtom/controls/ZoomSlider",[],function(){return L.Control.Zoomslider=function(){var e=L.Draggable.extend({initialize:function(e,t,n,r){var i=t*n;L.Draggable.prototype.initialize.call(this,e,e),this._element=e,this._maxValue=t-1,this._k=-n,this._m=i-(n+r)/2,this.on("predrag",function(){this._newPos.x=0,this._newPos.y=this._adjust(this._newPos.y)},this)},_adjust:function(e){var t=Math.round(this._toValue(e));return t=Math.max(0,Math.min(this._maxValue,t)),this._toY(t)},_toY:function(e){return this._k*e+this._m},_toValue:function(e){return(e-this._m)/this._k},setPosition:function(e){L.DomUtil.setPosition(this._element,L.point(0,this._adjust(e)))},setValue:function(e){this.setPosition(this._toY(e))},getValue:function(){return this._toValue(L.DomUtil.getPosition(this._element).y)}}),t=L.Control.extend({options:{position:"topleft",stepHeight:9,knobHeight:5,styleNS:"leaflet-control-zoomslider"},onAdd:function(e){var t=L.DomUtil.create("div",this.options.styleNS+" leaflet-bar");return L.DomEvent.disableClickPropagation(t),this._map=e,this._zoomInButton=this._createZoomButton("in","top",t,this._zoomIn),this._sliderElem=L.DomUtil.create("div",this.options.styleNS+"-slider leaflet-bar-part",t),this._zoomOutButton=this._createZoomButton("out","bottom",t,this._zoomOut),e.on("layeradd layerremove",this._refresh,this).on("zoomend",this._updateSlider,this).on("zoomend",this._updateDisabled,this).whenReady(this._createSlider,this).whenReady(this._createKnob,this).whenReady(this._updateSlider,this).whenReady(this._updateDisabled,this),t},onRemove:function(e){e.off("zoomend",this._updateSlider).off("zoomend",this._updateDisabled).off("layeradd layerremove",this._refresh)},_refresh:function(){if(!this._map||!this._map._container||!this._container)return;this._map.removeControl(this).addControl(this)},_zoomLevels:function(){return this._map.getMaxZoom()-this._map.getMinZoom()+1},_createSlider:function(){var e=this._zoomLevels();if(e==Infinity)return;this._sliderBody=L.DomUtil.create("div",this.options.styleNS+"-slider-body",this._sliderElem),this._sliderBody.style.height=this.options.stepHeight*e+"px",L.DomEvent.on(this._sliderBody,"click",this._onSliderClick,this)},_createKnob:function(){var t,n=this._zoomLevels();if(n==Infinity)return;t=L.DomUtil.create("div",this.options.styleNS+"-slider-knob",this._sliderBody),L.DomEvent.disableClickPropagation(t),this._knob=(new e(t,this._zoomLevels(),this.options.stepHeight,this.options.knobHeight)).on("dragend",this._updateZoom,this),this._knob.enable()},_onSliderClick:function(e){var t=e.touches&&e.touches.length===1?e.touches[0]:e,n=L.DomEvent.getMousePosition(t).y-L.DomUtil.getViewportOffset(this._sliderBody).y;this._knob.setPosition(n),this._updateZoom()},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createZoomButton:function(e,t,n,r){var i="leaflet-bar-part",s=this.options.styleNS+"-"+e+" "+i+" "+i+"-"+t,o="Zoom "+e,u=L.DomUtil.create("a",s,n);return u.href="#",u.title=o,L.DomEvent.on(u,"click",L.DomEvent.preventDefault).on(u,"click",r,this),u},_toZoomLevel:function(e){return e+this._map.getMinZoom()},_toSliderValue:function(e){return e-this._map.getMinZoom()},_updateZoom:function(){this._map.setZoom(this._toZoomLevel(this._knob.getValue()))},_updateSlider:function(){this._knob&&this._knob.setValue(this._toSliderValue(this._map.getZoom()))},_updateDisabled:function(){var e=this._map,t=this.options.styleNS+"-disabled";L.DomUtil.removeClass(this._zoomInButton,t),L.DomUtil.removeClass(this._zoomOutButton,t),e.getZoom()===e.getMinZoom()&&L.DomUtil.addClass(this._zoomOutButton,t),e.getZoom()===e.getMaxZoom()&&L.DomUtil.addClass(this._zoomInButton,t)}});return t}(),L.control.zoomslider=function(e){return new L.Control.Zoomslider(e)},L.Control.Zoomslider}),define("tomtom/controls/PanZoomBar",["../Main","./Pan","./ZoomSlider"],function(e,t,n){return tomtom.controls.PanZoomBar=L.Control.extend({options:{position:"topleft"},onAdd:function(e){var r=L.DomUtil.create("div","leaflet-control-pan-zoom");return this._pan=new t,r.appendChild(this._pan.onAdd(e)),this._zoomSlider=new n,r.appendChild(this._zoomSlider.onAdd(e)),r},onRemove:function(e){this._pan.onRemove(e),this._zoomSlider.onRemove(e)}}),tomtom.controls.PanZoomBar}),define("tomtom/controls/ContextMenu",["../Utils","../dom/DomUtil"],function(e,t){return tomtom.controls.ContextMenu=L.Control.extend({includes:L.Mixin.Events,initialize:function(e){this.container=document.createElement("ul"),this._eventHandles=[],this._targetElements=[],this._menuItemNodes=[];if(e.menuItems){this.menuItems=e.menuItems;for(var t=0;t<this.menuItems.length;t++)this.addMenuItem(this.menuItems[t])}this._documentClick=function(e){e.button!=2&&this.hide()},L.DomEvent.on(document,"click",this._documentClick,this)},addMenuItem:function(e){var n=document.createElement("li");n.innerHTML=e.label,L.DomEvent.on(n,"click",function(){this._menuItemClick(e)},this),L.DomEvent.on(n,"mouseover",this._menuItemHover),L.DomEvent.on(n,"mouseout",this._menuItemBlur),this.container.appendChild(n),t.query("li",this.container).removeClass("last"),t.query("li",this.container).removeClass("first"),t.query("li:last-child",this.container).addClass("last"),t.query("li:first-child",this.container).addClass("first"),this._menuItemNodes.push(n)},_menuItemHover:function(){t.addClass(this,"menuItemHover")},_menuItemBlur:function(){t.removeClass(this,"menuItemHover")},_menuItemClick:function(e){var t={menuItem:e,contextMenu:this,x:this.currentX,y:this.currentY,pageX:this.currentX,pageY:this.currentY,targetElement:this.currentTargetElement,targetObject:this.currentTargetObject};typeof e.onClick=="function"&&e.onClick(t),this.fire("menuitemclick",t)},addTarget:function(e,t){this._targetElements.indexOf(e)==-1&&(e._ttHandleContextMenu=L.Util.bind(function(n){return this._onContextMenu(n,e,t)},this),L.DomEvent.on(e,"contextmenu",e._ttHandleContextMenu,this))},removeTarget:function(e){var t=-1;this._targetElements.forEach(function(n,r){n==e&&(t=r)}),t!=-1&&this._targetElements.splice(t,1),L.DomEvent.off(e,"contextmenu",e._ttHandleContextMenu,this)},clearTargets:function(){this._targetElements.forEach(function(e,t){this.removeTarget(e)},this)},setData:function(e){this.data=e},getData:function(){return this.data},onAdd:function(e){this.map=e,t.addClass(this.container,"contextMenu"),e._container.appendChild(this.container),e._contextMenus||(e._contextMenus=[]),e._contextMenus.push(this)},onRemove:function(e){e||(e=this.map),L.DomEvent.off(document,"click",this._documentClick),this._documentClick=null,e._container.removeChild(this.container),this._targetElements.forEach(function(e){this.removeTarget(e)},this),this._menuItemNodes.forEach(function(e){t.off(e,"mouseover",this._menuItemHover),t.off(e,"mouseout",this._menuItemBlur),t.off(e,"click",this._menuItemClick)},this),this._menuItemNodes=[],this.menuItems=[]},hide:function(){t.removeClass(this.container,"contextMenuActive")},_onContextMenu:function(e,n,r){var i=t.offset(this.map._container),s=t.dimensions(this.container),o=t.dimensions(this.map._container),u=e.clientX-i.left,a=e.clientY-i.top;return u+s.outerWidth>o.width&&(u-=s.outerWidth),a+s.outerHeight>o.height&&(a-=s.outerHeight),this.currentX=u,this.currentY=a,t.css(this.container,"left",u+"px"),t.css(this.container,"top",a+"px"),t.addClass(this.container,"contextMenuActive"),L.DomEvent.stop(e),this.currentTargetElement=n,this.currentTargetObject=r,!1}}),tomtom.controls.ContextMenu}),define("tomtom/Map",["./Utils","./dom/DomUtil","./Logger","./services/InitializeService","./services/ViewportService","./services/RoutingService","./services/GeocodingService","./layers/MapLayer","./layers/TrafficLayer","./layers/TrafficIncidentLayer","./lib/leaflet.minimap","./controls/PanZoomBar","./controls/ContextMenu"],function(e,t){tomtom.Map=L.Map.extend({initialize:function(t){t||(t={}),this.log=new tomtom.Logger,this.apiKey=tomtom.apiKey,this._copyrightInfo={},this._displayRouteId=0,this._currentAttribution="",this._routeCallQueue=[],this._routeWaypoints=[],this._attributionClickHandlers=[],this.routeStyle=L.Util.extend({color:"#0f0",weight:8,opacity:.6},t.routeStyle),t.apiKey&&(this.apiKey=t.apiKey),t.geocodingService?this.geocodingService=t.geocodingService:this.geocodingService=new tomtom.services.GeocodingService(this.apiKey),t.minZoom||(t.minZoom=2),t.maxZoom||(t.maxZoom=17),t.center||(t.center=[0,0]),t.zoom||(t.zoom=2),t.attributionControl=!1;if(t.cookie){typeof t.cookie!="object"&&(t.cookie={}),t.cookie.name||(t.cookie.name="tomtom-map-extent");var n=e.getCookie(t.cookie.name);if(n){var r=n.split(",");if(r.length>=3){var i=r[0].trim(),s=r[1].trim();!isNaN(i)&&!isNaN(s)&&(t.center=new L.LatLng(parseFloat(i),parseFloat(s)),t.zoom=r[2].trim())}}}typeof t.zoomControl=="undefined"&&(t.zoomControl=!1),L.Map.prototype.initialize.apply(this,[t.domNode,t]),this.attributionControl=(new L.Control.Attribution({position:"bottomleft",prefix:""})).addTo(this);var o=new tomtom.services.InitializeService(this.apiKey);o.getCopyrightInfo(L.Util.bind(function(e){var n=e.initializeResponse.copyright;for(var r=0;r<n.length;r++){var i=n[r];i&&(this._copyrightInfo[i["@id"]]=i)}t.displayTraffic?this.setDisplayTraffic(!0):this._updateViewport(!1)},this));if(!t.layers){var u=L.Util.extend({apiKey:this.apiKey},t.baseLayerOptions||{});this._baseLayer=new tomtom.layers.MapLayer(u),this._baseLayer.on("load",this._fireLoad,this),this.addLayer(this._baseLayer)}t.scale&&L.control.scale().addTo(this),t.overviewMap&&(minimapOptions={toggleDisplay:!0},typeof t.overviewMap=="object"&&(minimapOptions=t.overviewMap),this._miniMap=(new L.Control.MiniMap(new tomtom.layers.MapLayer({apiKey:this.apiKey}),minimapOptions)).addTo(this)),t.panZoomBar&&(this._panZoomBar=new tomtom.controls.PanZoomBar,this._panZoomBar.addTo(this)),this._waypointContextMenu=new tomtom.controls.ContextMenu({menuItems:[{label:"Remove waypoint",onClick:L.Util.bind(this._removeWaypoint,this)}]}),this._waypointContextMenu.onAdd(this),this.on("moveend",this._handleMapMove,this),this.on("zoomend",this._handleZoomChange,this),this.on("mousemove",this._handleMouseMove,this),this.on("mouseup",this._handleMouseUp,this)},setDisplayTraffic:function(e){this._displayTraffic=e,e?(clearInterval(this._trafficUpdateIntervalId),this._updateViewport(!0),this._trafficUpdateIntervalId=setInterval(L.Util.bind(function(){this._updateViewport(!0)},this),n)):(this._trafficLayer&&(this.removeLayer(this._trafficLayer),this._trafficLayer=null),this._trafficIncidentLayer&&(this.removeLayer(this._trafficIncidentLayer),this._trafficIncidentLayer=null),clearInterval(this._trafficUpdateIntervalId))},destroy:function(){clearTimeout(this._viewportUpdateTimeoutId),clearInterval(this._trafficUpdateIntervalId);for(var e in this._layers)this.removeLayer(this._layers[e]);this._contextMenus&&(this._contextMenus.forEach(function(e){e.onRemove(this)},this),this._contextMenus=[],this._waypointContextMenu=null);var n=["dragging","scrollWheelZoom","touchZoom","keyboard","doubleClickZoom","boxZoom"];n.forEach(function(e){this[e]&&this[e].removeHooks()},this),this._container._leaflet=null;var r=this._leaflet_events;for(var i in r){var s=r[i];this.off(i,s.action,s.context)}L.DomEvent.off(this._container,"click",this._onMouseClick,this);var r=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],o,u;for(o=0,u=r.length;o<u;o++)L.DomEvent.off(this._container,r[o],this._fireMouseEvent,this);this.options.trackResize&&L.DomEvent.off(window,"resize",this._onResize,this),L.DomUtil.TRANSITION_END&&L.DomEvent.off(this._mapPane,L.DomUtil.TRANSITION_END,this._catchTransitionEnd),this._destroyAttribution();var a=t.create(this._container);a.empty();var f=this._container.className.split(" ");f.forEach(function(e){e.indexOf("leaflet")==0&&a.removeClass(e)}),a.css("position","")},displayRoute:function(e,t,n){this._isRoutingExecuting?this._routeCallQueue.push({points:e,options:t,callback:n}):(this._isRoutingExecuting=!0,typeof t=="function"&&(n=t,t={}),t=t?t:{},this._currentRouteOptions=t,(typeof t.showLoading=="undefined"||t.showLoading)&&this.displayLoadingMessage("Calculating route..."),this._displayRouteId++,this._routingCallback=n,typeof t.checkPoints=="undefined"||t.checkPoints?(this._originalRoutePoints=e,this._routePoints=[],this._waypointsNeedUpdate=!0,this._checkRoutePoints(this._displayRouteId,0,t)):this._getRoute(this._displayRouteId,t,typeof t.updateBounds=="undefined"?!0:t.updateBounds))},displayRouteInstruction:function(e){if(this._routeLayer){var t=this._currentRoute.instructions.instruction[e];this.setView([t.point.latitude,t.point.longitude],f),L.popup().setLatLng([t.point.latitude,t.point.longitude]).setContent(L.Util.template('<div class="tt-instruction-popup"><img src="{iconUrl}" /><span class="road">{text} {roadNumber} {roadName}</span></div>',{iconUrl:tomtom.baseImagePath+"instructions/"+t.iconPath,roadName:t.roadName,roadNumber:t.roadNumber,text:t.text})).openOn(this)}},clearRouting:function(){this._routeLayer&&(this.removeLayer(this._routeLayer),this._routeLayer=null),this._routeMarkerLayer&&(this.removeLayer(this._routeMarkerLayer),this._routeMarkerLayer=null),this._startMarker=null,this._endMarker=null,this._currentRoute=null,this._routeCallQueue=[],this._routeWaypoints.forEach(function(e){this.removeLayer(e)},this),this._routeWaypoints=[],this._waypointContextMenu.clearTargets()},getCurrentRoute:function(){return this._currentRoute},setContextMenu:function(e){this.contextMenu&&this.contextMenu.onRemove(this),this.contextMenu=e,e.addTarget(this._container,this),e.map||e.onAdd(this)},displayLoadingMessage:function(e){this._loadingBackdrop||(this._loadingBackdrop=L.DomUtil.create("div","loadingBackdrop"),this._container.appendChild(this._loadingBackdrop));if(!this._loadingMessage){this._loadingMessage=L.DomUtil.create("div","loadingMessage"),this._container.appendChild(this._loadingMessage);var n=L.DomUtil.create("div","image");this._loadingMessage.appendChild(n);var r=L.DomUtil.create("div","message");this._loadingMessage.appendChild(r)}t.query(".message",this._loadingMessage).html(e),this._loadingBackdrop.style.display="block",this._loadingMessage.style.display="block",this._loadingMessage.style.top=(this._container.offsetHeight-this._loadingMessage.offsetHeight)/2+"px",this._loadingMessage.style.left=(this._container.offsetWidth-this._loadingMessage.offsetWidth)/2+"px"},hideLoadingMessage:function(){this._loadingBackdrop&&(this._loadingBackdrop.style.display="none"),this._loadingMessage&&(this._loadingMessage.style.display="none")},getTrafficIncidents:function(){return this._trafficIncidentLayer&&this._trafficIncidentLayer.incidents?this._trafficIncidentLayer.incidents:null},getTrafficMarkerByIncidentId:function(e){var t=this._trafficIncidentLayer;if(t)for(var n in t._layers){var r=t._layers[n];if(r._incident.id==e)return r}return null},_checkRoutePoints:function(e,t,n){if(this._displayRouteId!=e)return;var r=this._originalRoutePoints[t];if(typeof r=="string"){var i=this.geocodingService;i.geocode(r,L.Util.bind(function(r){if(this._displayRouteId!=e)return;if(r.geoResponse&&r.geoResponse.geoResult){var i=r.geoResponse.geoResult,s=null;i.length!=null?s=L.latLng([i[0].latitude,i[0].longitude]):s=L.latLng([i.latitude,i.longitude]),this._routePoints.push(s),t>0&&t+1<this._originalRoutePoints.length&&this._addRouteWaypoint(s),t++,t>=this._originalRoutePoints.length?this._getRoute(e,n):this._checkRoutePoints(e,t,n)}else n.callback&&n.callback({error:"Geocode failed for point "+t})},this))}else if(t>=this._originalRoutePoints.length)this._getRoute(e,n);else{var s=L.latLng(this._originalRoutePoints[t]);this._routePoints.push(s),t>0&&t+1<this._originalRoutePoints.length&&this._addRouteWaypoint(s),this._checkRoutePoints(e,t+1,n)}},_getRoute:function(e,t,n){typeof n=="undefined"&&(n=!0);if(this._displayRouteId!=e)return;var r=new tomtom.services.RoutingService(this.apiKey);this.trafficModel&&(t.trafficModelId=this.trafficModel),t.pathPoints=17,r.getRoute(this._getUpdatedRoutePoints(),t,L.Util.bind(function(e){this._displayingRoute=!0;if(e.route){this._currentRoute=e.route;if(n&&(typeof t.updateBounds=="undefined"||t.updateBounds)){var r=e.route.summary.bbox;this.fitBounds([[r.bottomLeft.latitude,r.bottomLeft.longitude],[r.topRight.latitude,r.topRight.longitude]])}this._addRouteLayer()}else this.log.error("An error occurred during routing",e),this.hideLoadingMessage();this._routingCallback&&this._routingCallback(e),this.fire("routeend",e),this._displayingRoute=!1},this))},_addRouteLayer:function(){if(this._currentRoute){this._routeLayer&&(this.removeLayer(this._routeLayer),this._routeLayer=null),this._routeMarkerLayer||(this._routeMarkerLayer=L.layerGroup().addTo(this)),this._routeLayer=L.polyline([],this.routeStyle).addTo(this);var e=this._currentRoute.pathPoints.latitude,t=this._currentRoute.pathPoints.longitude,n=[];if(e.length>0){var r=e[0],i=t[0];for(var s=0;s<e.length;s++)s>0&&(r+=e[s],i+=t[s]),n.push(new L.LatLng(r,i));this._routeLayer.setLatLngs(n),this._updateWaypoints()}this._routeLayer.on("mousedown",function(e){if(e.originalEvent.button==2)return;this._currentWaypoint=this._addRouteWaypoint(e.latlng)},this),this._updateRouteMarkers()}this._isRoutingExecuting=!1;if(this._routeCallQueue.length>0){var o=this._routeCallQueue.pop();this.displayRoute(o.points,o.options,o.callback),this._routeCallQueue=[]}else this.hideLoadingMessage()},_addRouteWaypoint:function(e,t){typeof t=="undefined"&&(t=!0);if(this._routeWaypoints.length<3){var n=new tomtom.Marker(e,l);this.addLayer(n),n.setContextMenu(this._waypointContextMenu),L.DomEvent.on(n._icon,"mousedown",function(e){return L.DomEvent.stop(e),this._currentWaypoint=n,!1},this),L.DomEvent.on(n._icon,"dragstart",function(e){return L.DomEvent.stop(e),!1});var r=0,i=null,s=this._getUpdatedRoutePoints();return t?(s.forEach(function(t,n){if(n+1<s.length){var o=s[n+1],u=L.LineUtil.pointToSegmentDistance(new L.Point(e.lat,e.lng),new L.Point(t.lat,t.lng),new L.Point(o.lat,o.lng));if(i==null||u<i)i=u,r=n+1}},this),r>0&&r--,this._routeWaypoints.splice(r,0,n)):this._routeWaypoints.push(n),n}},_removeWaypoint:function(e){this.removeLayer(e.targetObject),this._routeWaypoints.splice(this._routeWaypoints.indexOf(e.targetObject),1);var t=L.Util.extend({showLoading:!1,updateMarkers:!1,updateBounds:!1,checkPoints:!1},this._currentRouteOptions);this.displayRoute([],t),this._waypointContextMenu.removeTarget(e.targetElement)},_handleMouseMove:function(e){if(this._currentWaypoint!=null){this._currentWaypoint.setLatLng(e.latlng);var t={};return t=L.Util.extend({showLoading:!1,updateMarkers:!1,updateBounds:!1,checkPoints:!1},this._currentRouteOptions),this.displayRoute([],t),L.DomEvent.stop(e),!1}},_getUpdatedRoutePoints:function(){var e=[];return e.push(this._routePoints[0]),this._routeWaypoints.forEach(function(t){e.push(t.getLatLng())},this),e.push(this._routePoints[this._routePoints.length-1]),e},_handleMouseUp:function(){this._currentWaypoint=null,this._waypointsNeedUpdate&&!this._isRoutingExecuting&&this._updateWaypoints()},_updateWaypoints:function(){if(this._currentWaypoint!=null)return;this._waypointsNeedUpdate=!1,this._routeWaypoints.forEach(function(e){var t=99999999,n=null;this._routeLayer.getLatLngs().some(function(r){var i=r.distanceTo(e.getLatLng());i<t&&(t=i,n=r)}),e.setLatLng(n)},this)},_updateRouteMarkers:function(){var e=this._currentRouteOptions,t=this._currentRoute.instructions.instruction,n=t[0],r=t[t.length-1],i=function(){var e=L.Util.extend({showLoading:!1,updateMarkers:!1,updateBounds:!1},this._currentRouteOptions);this.displayRoute([this._startMarker.getLatLng(),this._endMarker.getLatLng()],e)},s=!1;this._startMarker?s=!0:(this._startMarker=new tomtom.Marker([n.point.latitude,n.point.longitude],tomtom.Map.MARKER_OPTIONS_ROUTE_START,{draggable:!0}),this._startMarker.on("drag",i,this)),this._endMarker?s=!0:(this._endMarker=new tomtom.Marker([r.point.latitude,r.point.longitude],tomtom.Map.MARKER_OPTIONS_ROUTE_END,{draggable:!0}),this._endMarker.on("drag",i,this));if(s&&typeof e.updateMarkers=="undefined"||e.updateMarkers)this._startMarker.setLatLng([n.point.latitude,n.point.longitude]),this._endMarker.setLatLng([r.point.latitude,r.point.longitude]);this._routeMarkerLayer.addLayer(this._startMarker),this._routeMarkerLayer.addLayer(this._endMarker)},_updateViewport:function(e){var t=new tomtom.services.ViewportService(this.apiKey),n=this.getBounds(),r={top:n.getNorthEast().lat,right:n.getNorthEast().lng,bottom:n.getSouthWest().lat,left:n.getSouthWest().lng};t.getViewportModel(r,this.getZoom(),r,this.getZoom(),{projection:"EPSG4326",copyright:!1},L.Util.bind(function(t){if(t.viewpResp){this._updateAttribution(t.viewpResp);if(this._displayTraffic&&t.viewpResp.trafficState&&t.viewpResp.trafficState["@trafficModelId"]){var n=this.trafficModel=t.viewpResp.trafficState["@trafficModelId"];e?(this._trafficLayer==null?(this._trafficLayer=new tomtom.layers.TrafficLayer(this.apiKey,n),this.addLayer(this._trafficLayer)):this._trafficLayer.update(n),this._trafficIncidentLayer==null?(this._trafficIncidentLayer=new tomtom.layers.TrafficIncidentLayer(this.apiKey,n),this.addLayer(this._trafficIncidentLayer),this._trafficIncidentLayer.update(!0,n)):this._trafficIncidentLayer.update(!0,n)):this._trafficLayer&&(this._trafficLayer.setTrafficModel(n),this._trafficIncidentLayer.setTrafficModel(n))}}},this))},_registerViewportUpdateTimeout:function(){clearTimeout(this._viewportUpdateTimeoutId),this._viewportUpdateTimeoutId=setTimeout(L.Util.bind(function(){this._trafficIncidentLayer&&this._trafficIncidentLayer.update(!0,this.trafficModelId),this._updateViewport(!1)},this),500)},_fireLoad:function(){this._baseLayer.off("load",this._fireLoad),this.fire("load")},_handleZoomChange:function(){this._addRouteLayer()},_handleMapMove:function(){var t=this.getCenter();this.options.cookie&&e.setCookie(this.options.cookie.name,t.lat+","+t.lng+","+this.getZoom(),this.options.cookieExpirationDays),this._registerViewportUpdateTimeout()},_destroyAttribution:function(){this._attributionClickHandlers.forEach(function(e){t.off(e.element,"click",e.handler)}),this._attributionClickHandlers=[]},_updateAttribution:function(e){this._destroyAttribution(),this._currentAttribution&&this.attributionControl.removeAttribution(this._currentAttribution),this._currentAttribution="";var n=e.copyrightIds.toString().split("^");for(var r=0;r<n.length;r++){var i=this._copyrightInfo[n[r]];i&&(this._currentAttribution+='<a href="javascript:void(0);" data-id="'+i["@id"]+'">'+i.label+"</a> ")}this.attributionControl.addAttribution(this._currentAttribution),t.query("a",this.attributionControl._container).each(function(e){var n=function(n){this._attributionClick(t.attr(e,"data-id"),e,n)};this._attributionClickHandlers.push({element:e,handler:n}),t.on(e,"click",n,this)},this)},_attributionClick:function(e,n,r){if(e){var i=this._copyrightInfo[e];if(i){var s=document.createElement("img");L.DomEvent.on(s,"load",function(){var e=t.create("div","leaflet-popup"),n=t.create("a","leaflet-popup-close-button").html("x").attr("href","#close");e.append(n),e.css("opacity",1);var r=t.create("div","leaflet-popup-content-wrapper");e.append(r);var s=t.create("div","leaflet-popup-content").html('<div class="copyrightInfo"><img src="'+i.logo+'" class="copyrightLogo" />'+i.description+"</div>");r.append(s),this._container.appendChild(e.get());var o=t.dimensions(this._container);e.css("top",(o.height-e.offsetHeight())/2+"px"),e.css("left",(o.width-e.offsetWidth())/2+"px"),n.on("click",function(t){this._container.removeChild(e.get()),L.DomEvent.stop(t)},this)},this),s.src=i.logo,L.DomEvent.stop(r||event)}}}});var n=12e4,r=0,i=1,s=2,o=48,u=49,a=50,f=16,l={iconUrl:"waypoint.png",iconSize:[10,10],iconAnchor:[5,5]};return tomtom.Map.MARKER_LAYER_DEFAULT="DEFAULT",tomtom.Map.MARKER_LAYER_TRAFFIC="TRAFFIC",tomtom.Map.MARKER_OPTIONS_ROUTE_START={iconUrl:"marker_start.png",iconSize:[43,49],iconAnchor:[11,40],popupAnchor:[0,0]},tomtom.Map.MARKER_OPTIONS_ROUTE_END={iconUrl:"marker_finish.png",iconSize:[43,49],iconAnchor:[11,40],popupAnchor:[0,0]},tomtom.Map}),function(e,t){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(e){L.Util.setOptions(this,e),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),L.FeatureGroup.prototype.initialize.call(this,[]),this._inZoomAnimation=0,this._needsClustering=[],this._currentShownBounds=null},addLayer:function(e){if(e instanceof L.LayerGroup){var t=[];for(var n in e._layers)e._layers.hasOwnProperty(n)&&t.push(e._layers[n]);return this.addLayers(t)}if(!this._map)return this._needsClustering.push(e),this;if(this.hasLayer(e))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(e,this._maxZoom);var r=e,i=this._map.getZoom();if(e.__parent)while(r.__parent._zoom>=i)r=r.__parent;return this._currentShownBounds.contains(r.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(e,r):this._animationAddLayerNonAnimated(e,r)),this},removeLayer:function(e){return this._map?e.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(e)),this._removeLayer(e,!0),e._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,e),e.setOpacity(1)),this):this:(this._arraySplice(this._needsClustering,e),this)},addLayers:function(e){var t,n,r;if(!this._map)return this._needsClustering=this._needsClustering.concat(e),this;for(t=0,n=e.length;t<n;t++){r=e[t];if(this.hasLayer(r))continue;this._addLayer(r,this._maxZoom);if(r.__parent&&r.__parent.getChildCount()===2){var i=r.__parent.getAllChildMarkers(),s=i[0]===r?i[1]:i[0];L.FeatureGroup.prototype.removeLayer.call(this,s)}}for(t in this._layers)this._layers.hasOwnProperty(t)&&(r=this._layers[t],r instanceof L.MarkerCluster&&r._iconNeedsUpdate&&r._updateIcon());return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},removeLayers:function(e){var t,n,r;if(!this._map){for(t=0,n=e.length;t<n;t++)this._arraySplice(this._needsClustering,e[t]);return this}for(t=0,n=e.length;t<n;t++){r=e[t];if(!r.__parent)continue;this._removeLayer(r,!0,!0),r._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,r),r.setOpacity(1))}this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);for(t in this._layers)this._layers.hasOwnProperty(t)&&(r=this._layers[t],r instanceof L.MarkerCluster&&r._updateIcon());return this},clearLayers:function(){this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._unspiderfy&&this._unspiderfy();for(var e in this._layers)this._layers.hasOwnProperty(e)&&L.FeatureGroup.prototype.removeLayer.call(this,this._layers[e]);return this.eachLayer(function(e){delete e.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var e=new L.LatLngBounds;if(this._topClusterLevel)e.extend(this._topClusterLevel._bounds);else for(var t=this._needsClustering.length-1;t>=0;t--)e.extend(this._needsClustering[t].getLatLng());return e},eachLayer:function(e,t){var n=this._needsClustering.slice(),r;this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n);for(r=n.length-1;r>=0;r--)e.call(t,n[r])},hasLayer:function(e){if(this._needsClustering.length>0){var t=this._needsClustering;for(var n=t.length-1;n>=0;n--)if(t[n]===e)return!0}return!!e.__parent&&e.__parent._group===this},zoomToShowLayer:function(e,t){var n=function(){if((e._icon||e.__parent._icon)&&!this._inZoomAnimation){this._map.off("moveend",n,this),this.off("animationend",n,this);if(e._icon)t();else if(e.__parent._icon){var r=function(){this.off("spiderfied",r,this),t()};this.on("spiderfied",r,this),e.__parent.spiderfy()}}};e._icon?t():e.__parent._zoom<this._map.getZoom()?(this._map.on("moveend",n,this),e._icon||this._map.panTo(e.getLatLng())):(this._map.on("moveend",n,this),this.on("animationend",n,this),this._map.setView(e.getLatLng(),e.__parent._zoom+1),e.__parent.zoomToBounds())},onAdd:function(e){this._map=e,this._gridClusters||this._generateInitialClusters();for(var t=0,n=this._needsClustering.length;t<n;t++){var r=this._needsClustering[t];if(r.__parent)continue;this._addLayer(r,this._maxZoom)}this._needsClustering=[],this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(e){this._map.off("zoomend",this._zoomEnd,this),this._map.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove();for(var t in this._layers)this._layers.hasOwnProperty(t)&&L.FeatureGroup.prototype.removeLayer.call(this,this._layers[t]);this._map=null},_arraySplice:function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t){e.splice(n,1);return}},_removeLayer:function(e,t,n){var r=this._gridClusters,i=this._gridUnclustered,s=this._map;if(t)for(var o=this._maxZoom;o>=0;o--)if(!i[o].removeObject(e,s.project(e.getLatLng(),o)))break;var u=e.__parent,a=u._markers,f;this._arraySplice(a,e);while(u){u._childCount--;if(u._zoom<0)break;t&&u._childCount<=1?(f=u._markers[0]===e?u._markers[1]:u._markers[0],r[u._zoom].removeObject(u,s.project(u._cLatLng,u._zoom)),i[u._zoom].addObject(f,s.project(f.getLatLng(),u._zoom)),this._arraySplice(u.__parent._childClusters,u),u.__parent._markers.push(f),f.__parent=u.__parent,u._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,u),n||L.FeatureGroup.prototype.addLayer.call(this,f))):(u._recalculateBounds(),(!n||!u._icon)&&u._updateIcon()),u=u.__parent}delete e.__parent},_propagateEvent:function(e){e.target instanceof L.MarkerCluster&&(e.type="cluster"+e.type),L.FeatureGroup.prototype._propagateEvent.call(this,e)},_defaultIconCreateFunction:function(e){var t=e.getChildCount(),n=" marker-cluster-";return t<10?n+="small":t<100?n+="medium":n+="large",new L.DivIcon({html:"<div><span>"+t+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var e=null,t=this._map,n=this.options.spiderfyOnMaxZoom,r=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick;(n||i)&&this.on("clusterclick",function(e){t.getMaxZoom()===t.getZoom()?n&&e.layer.spiderfy():i&&e.layer.zoomToBounds()},this),r&&(this.on("clustermouseover",function(n){if(this._inZoomAnimation)return;e&&t.removeLayer(e),n.layer.getChildCount()>2&&n.layer!==this._spiderfied&&(e=new L.Polygon(n.layer.getConvexHull(),this.options.polygonOptions),t.addLayer(e))},this),this.on("clustermouseout",function(){e&&(t.removeLayer(e),e=null)},this),t.on("zoomend",function(){e&&(t.removeLayer(e),e=null)},this),t.on("layerremove",function(n){e&&n.layer===this&&(t.removeLayer(e),e=null)},this))},_unbindEvents:function(){var e=this.options.spiderfyOnMaxZoom,t=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,r=this._map;(e||n)&&this.off("clusterclick",null,this),t&&(this.off("clustermouseover",null,this),this.off("clustermouseout",null,this),r.off("zoomend",null,this),r.off("layerremove",null,this))},_zoomEnd:function(){if(!this._map)return;this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds()},_moveEnd:function(){if(this._inZoomAnimation)return;var e=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,e),this._currentShownBounds=e;return},_generateInitialClusters:function(){var e=this._map.getMaxZoom(),t=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(e=this.options.disableClusteringAtZoom-1),this._maxZoom=e,this._gridClusters={},this._gridUnclustered={};for(var n=e;n>=0;n--)this._gridClusters[n]=new L.DistanceGrid(t),this._gridUnclustered[n]=new L.DistanceGrid(t);this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(e,t){var n=this._gridClusters,r=this._gridUnclustered,i,s;this.options.singleMarkerMode&&(e.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[e]}}));for(;t>=0;t--){i=this._map.project(e.getLatLng(),t);var o=n[t].getNearObject(i);if(o){o._addChild(e),e.__parent=o;return}o=r[t].getNearObject(i);if(o){var u=o.__parent;u&&this._removeLayer(o,!1);var a=new L.MarkerCluster(this,t,o,e);n[t].addObject(a,this._map.project(a._cLatLng,t)),o.__parent=a,e.__parent=a;var f=a;for(s=t-1;s>u._zoom;s--)f=new L.MarkerCluster(this,s,f),n[s].addObject(f,this._map.project(o.getLatLng(),s));u._addChild(f);for(s=t;s>=0;s--)if(!r[s].removeObject(o,this._map.project(o.getLatLng(),s)))break;return}r[t].addObject(e,i)}this._topClusterLevel._addChild(e),e.__parent=this._topClusterLevel;return},_mergeSplitClusters:function(){this._zoom<this._map._zoom?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var e=this._map,t=e.getBounds(),n=t._southWest,r=t._northEast,i=L.Browser.mobile?0:Math.abs(n.lat-r.lat),s=L.Browser.mobile?0:Math.abs(n.lng-r.lng);return new L.LatLngBounds(new L.LatLng(n.lat-i,n.lng-s,!0),new L.LatLng(r.lat+i,r.lng+s,!0))},_animationAddLayerNonAnimated:function(e,t){if(t===e)L.FeatureGroup.prototype.addLayer.call(this,e);else if(t._childCount===2){t._addToMap();var n=t.getAllChildMarkers();L.FeatureGroup.prototype.removeLayer.call(this,n[0]),L.FeatureGroup.prototype.removeLayer.call(this,n[1])}else t._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(e,t){var n=this,r=this._getExpandedVisibleBounds(),i;this._topClusterLevel._recursively(r,e,0,function(s){var o=s._latlng,u=s._markers,a;s._isSingleParent()&&e+1===t?(L.FeatureGroup.prototype.removeLayer.call(n,s),s._recursivelyAddChildrenToMap(null,t,r)):(s.setOpacity(0),s._recursivelyAddChildrenToMap(o,t,r));for(i=u.length-1;i>=0;i--)a=u[i],r.contains(a._latlng)||L.FeatureGroup.prototype.removeLayer.call(n,a)}),this._forceLayout();var s,o;n._topClusterLevel._recursivelyBecomeVisible(r,t);for(s in n._layers)n._layers.hasOwnProperty(s)&&(o=n._layers[s],!(o instanceof L.MarkerCluster)&&o._icon&&o.setOpacity(1));n._topClusterLevel._recursively(r,e,t,function(e){e._recursivelyRestoreChildPositions(t)}),setTimeout(function(){n._topClusterLevel._recursively(r,e,0,function(e){L.FeatureGroup.prototype.removeLayer.call(n,e),e.setOpacity(1)}),n._animationEnd()},250)},_animationZoomOut:function(e,t){this._animationZoomOutSingle(this._topClusterLevel,e-1,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(e,t,n){var r=this._getExpandedVisibleBounds();e._recursivelyAnimateChildrenInAndAddSelfToMap(r,t+1,n);var i=this;this._forceLayout(),e._recursivelyBecomeVisible(r,n),setTimeout(function(){if(e._childCount===1){var s=e._markers[0];s.setLatLng(s.getLatLng()),s.setOpacity(1);return}e._recursively(r,n,0,function(e){e._recursivelyRemoveChildrenFromMap(r,t+1)}),i._animationEnd()},250)},_animationAddLayer:function(e,t){var n=this;L.FeatureGroup.prototype.addLayer.call(this,e),t!==e&&(t._childCount>2?(t._updateIcon(),this._forceLayout(),this._animationStart(),e._setPos(this._map.latLngToLayerPoint(t.getLatLng())),e.setOpacity(0),setTimeout(function(){L.FeatureGroup.prototype.removeLayer.call(n,e),e.setOpacity(1),n._animationEnd()},250)):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(t,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(e,t){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds())},_animationZoomOut:function(e,t){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds())},_animationAddLayer:function(e,t){this._animationAddLayerNonAnimated(e,t)}}),L.MarkerCluster=L.Marker.extend({initialize:function(e,t,n,r){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=e,this._zoom=t,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),r&&this._addChild(r)},getAllChildMarkers:function(e){e=e||[];for(var t=this._childClusters.length-1;t>=0;t--)this._childClusters[t].getAllChildMarkers(e);for(var n=this._markers.length-1;n>=0;n--)e.push(this._markers[n]);return e},getChildCount:function(){return this._childCount},zoomToBounds:function(){this._group._map.fitBounds(this._bounds)},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(e,t){this._iconNeedsUpdate=!0,this._expandBounds(e),e instanceof L.MarkerCluster?(t||(this._childClusters.push(e),e.__parent=this),this._childCount+=e._childCount):(t||this._markers.push(e),this._childCount++),this.__parent&&this.__parent._addChild(e,!0)},_expandBounds:function(e){var t,n=e._wLatLng||e._latlng;e instanceof L.MarkerCluster?(this._bounds.extend(e._bounds),t=e._childCount):(this._bounds.extend(n),t=1),this._cLatLng||(this._cLatLng=e._cLatLng||n);var r=this._childCount+t;this._wLatLng?(this._wLatLng.lat=(n.lat*t+this._wLatLng.lat*this._childCount)/r,this._wLatLng.lng=(n.lng*t+this._wLatLng.lng*this._childCount)/r):this._latlng=this._wLatLng=new L.LatLng(n.lat,n.lng)},_addToMap:function(e){e&&(this._backupLatlng=this._latlng,this.setLatLng(e)),L.FeatureGroup.prototype.addLayer.call(this._group,this)},_recursivelyAnimateChildrenIn:function(e,t,n){this._recursively(e,0,n-1,function(e){var n=e._markers,r,i;for(r=n.length-1;r>=0;r--)i=n[r],i._icon&&(i._setPos(t),i.setOpacity(0))},function(e){var n=e._childClusters,r,i;for(r=n.length-1;r>=0;r--)i=n[r],i._icon&&(i._setPos(t),i.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(e,t,n){this._recursively(e,n,0,function(r){r._recursivelyAnimateChildrenIn(e,r._group._map.latLngToLayerPoint(r.getLatLng()).round(),t),r._isSingleParent()&&t-1===n?(r.setOpacity(1),r._recursivelyRemoveChildrenFromMap(e,t)):r.setOpacity(0),r._addToMap()})},_recursivelyBecomeVisible:function(e,t){this._recursively(e,0,t,null,function(e){e.setOpacity(1)})},_recursivelyAddChildrenToMap:function(e,t,n){this._recursively(n,-1,t,function(r){if(t===r._zoom)return;for(var i=r._markers.length-1;i>=0;i--){var s=r._markers[i];if(!n.contains(s._latlng))continue;e&&(s._backupLatlng=s.getLatLng(),s.setLatLng(e),s.setOpacity(0)),L.FeatureGroup.prototype.addLayer.call(r._group,s)}},function(t){t._addToMap(e)})},_recursivelyRestoreChildPositions:function(e){for(var t=this._markers.length-1;t>=0;t--){var n=this._markers[t];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(e-1===this._zoom)for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._restorePosition();else for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i]._recursivelyRestoreChildPositions(e)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(e,t,n){var r,i;this._recursively(e,-1,t-1,function(e){for(i=e._markers.length-1;i>=0;i--){r=e._markers[i];if(!n||!n.contains(r._latlng))L.FeatureGroup.prototype.removeLayer.call(e._group,r),r.setOpacity(1)}},function(e){for(i=e._childClusters.length-1;i>=0;i--){r=e._childClusters[i];if(!n||!n.contains(r._latlng))L.FeatureGroup.prototype.removeLayer.call(e._group,r),r.setOpacity(1)}})},_recursively:function(e,t,n,r,i){var s=this._childClusters,o=this._zoom,u,a;if(t>o)for(u=s.length-1;u>=0;u--)a=s[u],e.intersects(a._bounds)&&a._recursively(e,t,n,r,i);else{r&&r(this),i&&this._zoom===n&&i(this);if(n>o)for(u=s.length-1;u>=0;u--)a=s[u],e.intersects(a._bounds)&&a._recursively(e,t,n,r,i)}},_recalculateBounds:function(){var e=this._markers,t=this._childClusters,n;this._bounds=new L.LatLngBounds,delete this._wLatLng;for(n=e.length-1;n>=0;n--)this._expandBounds(e[n]);for(n=t.length-1;n>=0;n--)this._expandBounds(t[n])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(e,t){var n=this._getCoord(t.x),r=this._getCoord(t.y),i=this._grid,s=i[r]=i[r]||{},o=s[n]=s[n]||[],u=L.Util.stamp(e);this._objectPoint[u]=t,o.push(e)},updateObject:function(e,t){this.removeObject(e),this.addObject(e,t)},removeObject:function(e,t){var n=this._getCoord(t.x),r=this._getCoord(t.y),i=this._grid,s=i[r]=i[r]||{},o=s[n]=s[n]||[],u,a;delete this._objectPoint[L.Util.stamp(e)];for(u=0,a=o.length;u<a;u++)if(o[u]===e)return o.splice(u,1),a===1&&delete s[n],!0},eachObject:function(e,t){var n,r,i,s,o,u,a,f=this._grid;for(n in f)if(f.hasOwnProperty(n)){o=f[n];for(r in o)if(o.hasOwnProperty(r)){u=o[r];for(i=0,s=u.length;i<s;i++)a=e.call(t,u[i]),a&&(i--,s--)}}},getNearObject:function(e){var t=this._getCoord(e.x),n=this._getCoord(e.y),r,i,s,o,u,a,f,l,c=this._objectPoint,h=this._sqCellSize,p=null;for(r=n-1;r<=n+1;r++){o=this._grid[r];if(o)for(i=t-1;i<=t+1;i++){u=o[i];if(u)for(s=0,a=u.length;s<a;s++)f=u[s],l=this._sqDist(c[L.Util.stamp(f)],e),l<h&&(h=l,p=f)}}return p},_getCoord:function(e){return Math.floor(e/this._cellSize)},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}},function(){L.QuickHull={getDistant:function(e,t){var n=t[1].lat-t[0].lat,r=t[0].lng-t[1].lng;return r*(e.lat-t[0].lat)+n*(e.lng-t[0].lng)},findMostDistantPointFromBaseLine:function(e,t){var n=0,r=null,i=[],s,o,u;for(s=t.length-1;s>=0;s--){o=t[s],u=this.getDistant(o,e);if(!(u>0))continue;i.push(o),u>n&&(n=u,r=o)}return{maxPoint:r,newPoints:i}},buildConvexHull:function(e,t){var n=[],r=this.findMostDistantPointFromBaseLine(e,t);return r.maxPoint?(n=n.concat(this.buildConvexHull([e[0],r.maxPoint],r.newPoints)),n=n.concat(this.buildConvexHull([r.maxPoint,e[1]],r.newPoints)),n):[e]},getConvexHull:function(e){var t=!1,n=!1,r=null,i=null,s;for(s=e.length-1;s>=0;s--){var o=e[s];if(t===!1||o.lat>t)r=o,t=o.lat;if(n===!1||o.lat<n)i=o,n=o.lat}var u=[].concat(this.buildConvexHull([i,r],e),this.buildConvexHull([r,i],e));return u}}}(),L.MarkerCluster.include({getConvexHull:function(){var e=this.getAllChildMarkers(),t=[],n=[],r,i,s;for(s=e.length-1;s>=0;s--)i=e[s].getLatLng(),t.push(i);r=L.QuickHull.getConvexHull(t);for(s=r.length-1;s>=0;s--)n.push(r[s][0]);return n}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied===this||this._group._inZoomAnimation)return;var e=this.getAllChildMarkers(),t=this._group,n=t._map,r=n.latLngToLayerPoint(this._latlng),i;this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?i=this._generatePointsSpiral(e.length,r):(r.y+=10,i=this._generatePointsCircle(e.length,r)),this._animationSpiderfy(e,i)},unspiderfy:function(e){if(this._group._inZoomAnimation)return;this._animationUnspiderfy(e),this._group._spiderfied=null},_generatePointsCircle:function(e,t){var n=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+e),r=n/this._2PI,i=this._2PI/e,s=[],o,u;s.length=e;for(o=e-1;o>=0;o--)u=this._circleStartAngle+o*i,s[o]=(new L.Point(t.x+r*Math.cos(u),t.y+r*Math.sin(u)))._round();return s},_generatePointsSpiral:function(e,t){var n=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,r=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,i=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,s=0,o=[],u;o.length=e;for(u=e-1;u>=0;u--)s+=r/n+u*5e-4,o[u]=(new L.Point(t.x+n*Math.cos(s),t.y+n*Math.sin(s)))._round(),n+=this._2PI*i/s;return o}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return document.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(e,t){var n=this,r=this._group,i=r._map,s=i.latLngToLayerPoint(this._latlng),o,u,a,f;for(o=e.length-1;o>=0;o--)u=e[o],u.setZIndexOffset(1e6),u.setOpacity(0),L.FeatureGroup.prototype.addLayer.call(r,u),u._setPos(s);r._forceLayout(),r._animationStart();var l=L.Path.SVG?0:.3,c=L.Path.SVG_NS;for(o=e.length-1;o>=0;o--){f=i.layerPointToLatLng(t[o]),u=e[o],u._preSpiderfyLatlng=u._latlng,u.setLatLng(f),u.setOpacity(1),a=new L.Polyline([n._latlng,f],{weight:1.5,color:"#222",opacity:l}),i.addLayer(a),u._spiderLeg=a;if(!L.Path.SVG||!this.SVG_ANIMATION)continue;var h=a._path.getTotalLength();a._path.setAttribute("stroke-dasharray",h+","+h);var p=document.createElementNS(c,"animate");p.setAttribute("attributeName","stroke-dashoffset"),p.setAttribute("begin","indefinite"),p.setAttribute("from",h),p.setAttribute("to",0),p.setAttribute("dur",.25),a._path.appendChild(p),p.beginElement(),p=document.createElementNS(c,"animate"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("begin","indefinite"),p.setAttribute("from",0),p.setAttribute("to",.5),p.setAttribute("dur",.25),a._path.appendChild(p),p.beginElement()}n.setOpacity(.3);if(L.Path.SVG){this._group._forceLayout();for(o=e.length-1;o>=0;o--)u=e[o]._spiderLeg,u.options.opacity=.5,u._path.setAttribute("stroke-opacity",.5)}setTimeout(function(){r._animationEnd(),r.fire("spiderfied")},250)},_animationUnspiderfy:function(e){var t=this._group,n=t._map,r=e?n._latLngToNewLayerPoint(this._latlng,e.zoom,e.center):n.latLngToLayerPoint(this._latlng),i=this.getAllChildMarkers(),s=L.Path.SVG&&this.SVG_ANIMATION,o,u,a;t._animationStart(),this.setOpacity(1);for(u=i.length-1;u>=0;u--){o=i[u];if(!o._preSpiderfyLatlng)continue;o.setLatLng(o._preSpiderfyLatlng),delete o._preSpiderfyLatlng,o._setPos(r),o.setOpacity(0),s&&(a=o._spiderLeg._path.childNodes[0],a.setAttribute("to",a.getAttribute("from")),a.setAttribute("from",0),a.beginElement(),a=o._spiderLeg._path.childNodes[1],a.setAttribute("from",.5),a.setAttribute("to",0),a.setAttribute("stroke-opacity",0),a.beginElement(),o._spiderLeg._path.setAttribute("stroke-opacity",0))}setTimeout(function(){var e=0;for(u=i.length-1;u>=0;u--)o=i[u],o._spiderLeg&&e++;for(u=i.length-1;u>=0;u--){o=i[u];if(!o._spiderLeg)continue;o.setOpacity(1),o.setZIndexOffset(0),e>1&&L.FeatureGroup.prototype.removeLayer.call(t,o),n.removeLayer(o._spiderLeg),delete o._spiderLeg}t._animationEnd()},250)}}:{_animationSpiderfy:function(e,t){var n=this._group,r=n._map,i,s,o,u;for(i=e.length-1;i>=0;i--)u=r.layerPointToLatLng(t[i]),s=e[i],s._preSpiderfyLatlng=s._latlng,s.setLatLng(u),s.setZIndexOffset(1e6),L.FeatureGroup.prototype.addLayer.call(n,s),o=new L.Polyline([this._latlng,u],{weight:1.5,color:"#222"}),r.addLayer(o),s._spiderLeg=o;this.setOpacity(.3),n.fire("spiderfied")},_animationUnspiderfy:function(){var e=this._group,t=e._map,n=this.getAllChildMarkers(),r,i;this.setOpacity(1);for(i=n.length-1;i>=0;i--)r=n[i],L.FeatureGroup.prototype.removeLayer.call(e,r),r.setLatLng(r._preSpiderfyLatlng),delete r._preSpiderfyLatlng,r.setZIndexOffset(0),t.removeLayer(r._spiderLeg),delete r._spiderLeg}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation?this._map.on("zoomstart",this._unspiderfyZoomStart,this):this._map.on("zoomend",this._unspiderfyWrapper,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){if(!this._map)return;this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(e){if(L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching"))return;this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(e)},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(e){this._spiderfied&&this._spiderfied.unspiderfy(e)},_unspiderfyLayer:function(e){e._spiderLeg&&(L.FeatureGroup.prototype.removeLayer.call(this,e),e.setOpacity(1),e.setZIndexOffset(0),this._map.removeLayer(e._spiderLeg),delete e._spiderLeg)}})}(this),define("tomtom/lib/leaflet.markercluster-src",function(){}),define("tomtom/MarkerManager",["./Main","./Logger","./lib/leaflet.markercluster-src"],function(e,t){var n=new t;tomtom.MarkerManager=L.Class.extend({initialize:function(e){L.Util.extend(this,e),this.markers=[],this.removedMarkers=[],this.markerMap={},this.animationTimeouts=[],this._completedAnimations=0,this._isMoveEndRegistered=!1,this.previousMarkerIds={},this.animation&&typeof this.animation!="object"&&(this.animation={effect:"fade",duration:r,delay:i}),this.clustering&&typeof this.clustering!="object"&&(this.clustering={}),this.clustering?this.layer=(new L.MarkerClusterGroup(this.clustering)).addTo(this.map):this.layer=(new L.LayerGroup).addTo(this.map),this.map.on("zoomstart",this._zoomStart,this)},addMarker:function(e,t){var n=this.map;e.map=n,this.markers.push(e),t&&(e.id=t,this.markerMap[t]=e)},getMarkerById:function(e){var t=this.markerMap[e];return t?t:null},clearMarkers:function(){this.previousMarkerIds={},this.removedMarkers=this.markers;for(var e in this.markerMap)this.previousMarkerIds[e]=!0;this.markers=[],this.markerMap={}},removeMarker:function(e){e.id&&delete this.markerMap[e.id];var t=this._getMarkerIndex(e);t>=0&&(this.removedMarkers.push(e),this.markers.splice(t,1))},update:function(e){typeof e=="undefined"&&(e=!0);var t=this.map,n=this.layer;this._isMoveEndRegistered||(this._isMoveEndRegistered=!0,t.on("moveend",this._mapMoveEnd,this)),this._updateLayer(n,e),this.removedMarkers=[]},animateMarker:function(e,t,n,s){if(this.animation&&this.animation.effect){var o="",u={delay:t*(this.animation.delay!=null?this.animation.delay:i),duration:this.animation.duration?this.animation.duration:r,callback:s};n&&(o=n=="show"?"In":"Out"),e.animate(this.animation.effect+o,u)}},destroy:function(){var e=this.map,t=this.layer;for(var n=0;n<this.markers.length;n++){var r=this.markers[n];t.removeMarker(r)}e.off("moveend",this._mapMoveEnd),e.off("zoomstart",this._zoomStart)},_getMarkerIndex:function(e){for(var t=0;t<this.markers.length;t++)if(this.markers[t]==e)return t;return null},_updateLayer:function(e,t){var r=this.map.getBounds(),i=new Date,s=this.markers;for(var o=0;o<s.length;o++){var u=this.markers[o];!u._map&&(r.contains(u.getLatLng())||this.clustering)&&(e.addLayer(u),t&&this.animation&&(!u.id||!this.previousMarkerIds[u.id])&&this.animateMarker(u,o,"show"))}for(var a=0;a<this.removedMarkers.length;a++){var u=this.removedMarkers[a];e.removeLayer(u)}n.debug("Updating markers took "+(new Date-i)+"ms")},_mapMoveEnd:function(){this.update()},_zoomStart:function(){var e=this.markers;for(var t=0;t<e.length;t++)e[t].stopAnimation()}});var r=250,i=0;return tomtom.MarkerManager}),define("tomtom/layers/WMSLayer",["../Utils","../Main"],function(e){tomtom.layers.WMSLayer=L.TileLayer.WMS.extend({initialize:function(e,t){L.TileLayer.WMS.prototype.initialize.apply(this,arguments),t.srs&&(this.wmsParams.srs=t.srs)},onAdd:function(e){var t=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.options.srs||(this.wmsParams[t]=e.options.crs.code),L.TileLayer.prototype.onAdd.call(this,e)}})}),define("tomtom/services/LegacyGeocodingService",["./BaseService","../Utils","../AjaxUtil"],function(e,t,n){tomtom.services.LegacyGeocodingService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},geocode:function(e,i,s){typeof i=="function"&&(s=i,i={});var o={q:e};this.apiKey&&(o.key=this.apiKey),o=L.Util.extend(o,i),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(r+"/json",o),callback:s}):n.getJSONP({url:t.getServiceUrl(r+"/jsonp",o),callback:s,callbackParam:"jsonp"})},reverseGeocode:function(e,r,s,o){if(isNaN(r)){o=s,s=r;var u=L.latLng(e);e=u.lat,r=u.lng}typeof s=="function"&&(o=s,s={});var a={point:e+","+r,projection:"EPSG4326"};a=L.Util.extend(a,s),this.apiKey&&(a.key=this.apiKey),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(i,a),callback:o}):n.getJSONP({url:t.getServiceUrl(i+"p",a),callback:o,callbackParam:"jsonp"})}});var r="lbs/services/geocode/3/geocode",i="lbs/services/reverseGeocode/3/json";return tomtom.services.GeocodingService})